{"version":3,"sources":["webpack:///./src/views/Viewer.vue?5e31","webpack:///./src/views/Viewer.vue?6ddb","webpack:///./src/components/Viz.vue?08b7","webpack:///./node_modules/three-spritetext/dist/three-spritetext.module.js","webpack:///src/components/Viz.vue","webpack:///./src/components/Viz.vue?90c1","webpack:///./src/components/Viz.vue","webpack:///src/views/Viewer.vue","webpack:///./src/views/Viewer.vue?bf42","webpack:///./src/views/Viewer.vue","webpack:///./src/views/Viewer.vue?be2d","webpack:///./src/components/Viz.vue?5ebf"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","back","_v","_e","_s","formattedItemsTotal","description","ref","class","file","hidden","fileData","id","fileHidden","$event","_l","color","index","key","style","backgroundColor","width","percent","colorNames","join","title","filesBaseUrl","image","sort","path","query","directives","name","rawName","value","expression","domProps","Array","isArray","atlasShown","_i","$$a","$$el","target","$$c","checked","$$v","$$i","concat","slice","confirmAtlas","base","overlay","element","document","closeButton","assignDialogRef","scopedSlots","_u","fn","proxy","acceptAtlas","cancelAtlas","staticRenderFns","preventDefault","onDocumentMouseMove","onDocumentMouseDown","onDocumentMouseUp","onDoubleClick","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","_createClass","protoProps","staticProps","prototype","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","p","_assertThisInitialized","self","ReferenceError","_possibleConstructorReturn","call","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","arr2","iter","Symbol","iterator","toString","from","three","window","THREE","LinearFilter","Sprite","SpriteMaterial","Texture","_default","_three$Sprite","_this","text","arguments","undefined","textHeight","map","_text","_textHeight","_color","_fontFace","_fontSize","_fontWeight","_canvas","createElement","_texture","material","minFilter","_genCanvas","_this2","canvas","ctx","getContext","lines","split","font","fontWeight","fontSize","fontFace","Math","max","apply","line","measureText","height","fillStyle","textBaseline","forEach","fillText","needsUpdate","yScale","scale","set","copy","source","get","CAMERA_NEAR","CAMERA_FAR","CAMERA_FOV","CAMERA_MIN_DIST","CAMERA_MAX_DIST","SMALL_ATLAS_SIZE","BIG_ATLAS_SIZE","ATLAS_TILE_SIZE","EMPTY_TEXTURE","BASE_SCALE","BUCKET_Z","BUCKET_PADDING","FILE_Z","CURSOR_COLOR","MOVE_DURATION","SCENE_PADDING","TEXT_SIZE","TEXT_Z","TILE_PADDING","vShader","buildTextureTree","count","tree","str","push","fShader","atlasCount","getPointScale","side","innerHeight","getBoundsFromMesh","obj","instanceMatrix","matrix","s","q","i3","l","getMatrixAt","decompose","x","y","z","objBucket","position","expandByObject","getBoundsFromGroup","children","child","easeInOutQuad","t","b","c","d","createBaseCamera","aspect","innerWidth","camera","updateProjectionMatrix","createEmptyAtlases","atlases","createText","isNaN","indexOf","myText","center","components","isDragging","lastMouse","bucketsGroup","cameraMoveStart","cameraObj","controls","cursor","detailMode","isMoving","lastMouseMoveId","lastChange","lastFileId","fileMode","filesMoveFrom","filesMoveStart","filesMoveTo","filesObject","lastCamera","mouse","PAST_INTERSECTED","pickingMesh","raycaster","renderer","scaled","scene","selectedInstance","selectedBucket","textGroup","toCamera","toLook","visibleFiles","visibleFilesCount","computed","init","createControls","paintBuckets","moveCameraTo","animate","addEventListener","onResize","onDocumentMouseOut","removeEventListener","watch","newB","initFiles","paintSort","paintAtlas","shown","calculateAtlases","fetchAtlases","to","Date","now","methods","layers","enable","cleanFiles","hideCursor","$store","commit","antialias","$refs","powerPreference","outputEncoding","gammaFactor","setPixelRatio","devicePixelRatio","setSize","background","geometry","moveTo","lineTo","mesh","visible","add","e","disableAll","instanceId","bucketIndex","stuff","w","parameters","setTimeout","TrackballControls","rotateSpeed","zoomSpeed","panSpeed","maxDistance","minDistance","mouseButtons","LEFT","PAN","RIGHT","ROTATE","noRotate","dynamicDampingFactor","remove","dispose","tileCount","smallAtlasCount","pow","bigAtlasCount","countPerAtlas","atlasSize","atlasPerSide","ceil","loadedAtlases","currentBucket","bucket","getCurrentAtlases","showAtlases","observable","Number","POSITIVE_INFINITY","uniforms","texture","sqrt","tileSize","realW","fetched","vertexShader","fragmentShader","type","atlasPx","cellPx","pointScale","depthTest","transparent","vertexColors","uvs","Float32Array","fIndices","fileIndex","floor","j","setAttribute","sizes","fill","defaultColors","frustumCulled","emptyTexture","planeMaterial","opacity","pickingGeometry","mga","defaultPositions","huePositions","tsnePositions","spacing","positions","xF","yF","zF","xT","yT","zT","xx","yy","zz","toArray","cleanBuckets","buckets","values","filter","a","bucketCount","colors","xini","yini","fullW","pct","itemsTotal","setHSL","url","images","random","load","encoding","textTop","textZ","labelStr","numberStr","toUpperCase","Intl","NumberFormat","format","setFromObject","sphere","getBoundingSphere","radius","getCenter","fov","PI","dist","abs","sin","dir","newPos","addVectors","setLength","clone","cF","cT","requestAnimationFrame","interpolateCamera","interpolateFiles","update","h","event","lastX","clientX","lastY","clientY","newX","newY","isClick","loadFile","backToEverything","classList","setFromCamera","pickBucket","pickFile","uv","mx","my","col","row","size","xmin","xmax","ymin","ymax","fileId","ids","hueIndexes","tsneIndexes","normalizedX","normalizedY","halfWidth","normalizedHalfTile","tx","ty","intersects","intersectObject","data","getFileAt","point","dispatch","ch","object","component","FILES_BASE_URL","Viz","newData","viz","dialog","hide","confirmedAtlas","show","trim","totalFromBuckets","$route"],"mappings":"yGAAA,yBAA2gB,EAAG,G,kHCA9gB,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAQF,EAAU,OAAEI,EAAG,MAAM,CAACE,YAAY,OAAOC,MAAM,CAAC,GAAK,WAAW,CAACH,EAAG,MAAM,CAACE,YAAY,UAAU,CAACF,EAAG,KAAK,CAACE,YAAY,SAAS,CAAEN,EAAiB,cAAEI,EAAG,IAAI,CAACA,EAAG,SAAS,CAACE,YAAY,cAAcC,MAAM,CAAC,KAAO,UAAUC,GAAG,CAAC,MAAQR,EAAIS,OAAO,CAACT,EAAIU,GAAG,8BAA8BV,EAAIW,KAAKP,EAAG,SAAS,CAACJ,EAAIU,GAAGV,EAAIY,GAAGZ,EAAIa,wBAAwBb,EAAIU,GAAG,IAAIV,EAAIY,GAAGZ,EAAIc,aAAa,SAASV,EAAG,MAAM,CAACW,IAAI,OAAOC,MAAM,CAAEC,MAAM,EAAMC,QAASlB,EAAImB,SAASC,IAAMpB,EAAIqB,aAAc,CAACjB,EAAG,SAAS,CAACE,YAAY,cAAcC,MAAM,CAAC,KAAO,UAAUC,GAAG,CAAC,MAAQ,SAASc,GAAQtB,EAAIqB,YAAa,KAAQ,CAACrB,EAAIU,GAAG,YAAaV,EAAImB,SAAgB,QAAEf,EAAG,MAAM,CAACE,YAAY,WAAWN,EAAIuB,GAAIvB,EAAImB,SAAgB,SAAE,SAASK,EAAMC,GAAO,OAAOrB,EAAG,OAAO,CAACsB,IAAID,EAAMnB,YAAY,QAAQqB,MAAM,CAC/1BC,gBAAiBJ,EAAMA,MACvBK,MAAuB,IAAhBL,EAAMM,QAAgB,KAC5BvB,MAAM,CAAC,MAAQP,EAAImB,SAASY,WAAWN,GAAOO,KAAK,YAAW,GAAGhC,EAAIW,KAAOX,EAAImB,SAASc,MAAgEjC,EAAIW,KAA7DP,EAAG,MAAM,CAACE,YAAY,WAAW,CAACN,EAAIU,GAAG,gBAAyBN,EAAG,IAAI,CAACG,MAAM,CAAC,KAAOP,EAAIkC,aAAe,IAAMlC,EAAImB,SAASC,GAAG,IAAM,WAAW,OAAS,WAAW,CAAEpB,EAAImB,SAAc,MAAEf,EAAG,MAAM,CAACE,YAAY,YAAYC,MAAM,CAAC,IAAMP,EAAImB,SAASgB,MAAM,IAAMnC,EAAImB,SAASc,MAAM,MAAQjC,EAAImB,SAASc,SAASjC,EAAIW,OAAQX,EAAImB,SAAc,MAAEf,EAAG,IAAI,CAACE,YAAY,oBAAoB,CAACF,EAAG,IAAI,CAACG,MAAM,CAAC,KAAOP,EAAIkC,aAAe,IAAMlC,EAAImB,SAASC,GAAG,IAAM,WAAW,OAAS,WAAW,CAACpB,EAAIU,GAAG,IAAIV,EAAIY,GAAGZ,EAAImB,SAASc,OAAO,SAASjC,EAAIW,OAAOP,EAAG,MAAM,CAACE,YAAY,YAAY,CAACF,EAAG,MAAM,CAACE,YAAY,QAAQ,CAACF,EAAG,cAAc,CAACY,MAAM,CAAC,cAA4B,YAAbhB,EAAIoC,KAAqB,SAAW,IAAI7B,MAAM,CAAC,GAAK,CAAE8B,KAAM,OAAQ,CAACrC,EAAIU,GAAG,eAAeN,EAAG,cAAc,CAACY,MAAM,CAAC,cAA4B,QAAbhB,EAAIoC,KAAiB,SAAW,IAAI7B,MAAM,CAAC,GAAK,CAAE8B,KAAM,IAAKC,MAAO,CAAEF,KAAM,UAAY,CAACpC,EAAIU,GAAG,aAAaN,EAAG,cAAc,CAACY,MAAM,CAAC,cAA4B,YAAbhB,EAAIoC,KAAqB,SAAW,IAAI7B,MAAM,CAAC,GAAK,CAAE8B,KAAM,IAAKC,MAAO,CAAEF,KAAM,cAAgB,CAACpC,EAAIU,GAAG,mBAAmB,GAAGN,EAAG,MAAM,CAACE,YAAY,SAAS,CAACF,EAAG,QAAQ,CAACG,MAAM,CAAC,IAAM,UAAU,CAACH,EAAG,QAAQ,CAACmC,WAAW,CAAC,CAACC,KAAK,QAAQC,QAAQ,UAAUC,MAAO1C,EAAc,WAAE2C,WAAW,eAAepC,MAAM,CAAC,KAAO,WAAW,GAAK,SAASqC,SAAS,CAAC,QAAUC,MAAMC,QAAQ9C,EAAI+C,YAAY/C,EAAIgD,GAAGhD,EAAI+C,WAAW,OAAO,EAAG/C,EAAc,YAAGQ,GAAG,CAAC,OAAS,CAAC,SAASc,GAAQ,IAAI2B,EAAIjD,EAAI+C,WAAWG,EAAK5B,EAAO6B,OAAOC,IAAIF,EAAKG,QAAuB,GAAGR,MAAMC,QAAQG,GAAK,CAAC,IAAIK,EAAI,KAAKC,EAAIvD,EAAIgD,GAAGC,EAAIK,GAAQJ,EAAKG,QAASE,EAAI,IAAIvD,EAAI+C,WAAWE,EAAIO,OAAO,CAACF,KAAYC,GAAK,IAAIvD,EAAI+C,WAAWE,EAAIQ,MAAM,EAAEF,GAAKC,OAAOP,EAAIQ,MAAMF,EAAI,UAAWvD,EAAI+C,WAAWK,GAAMpD,EAAI0D,iBAAiB1D,EAAIU,GAAG,2BAA2BN,EAAG,cAAc,CAACG,MAAM,CAAC,GAAK,aAAa,WAAW,UAAU,cAAc,eAAe,cAAc,CAC15DoD,KAAM,SACNC,QAAS,iBACTC,QAAS,iBACT5B,MAAO,eACP6B,SAAU,kBACVC,YAAa,iBACZvD,GAAG,CAAC,aAAaR,EAAIgE,iBAAiBC,YAAYjE,EAAIkE,GAAG,CAAC,CAACxC,IAAI,QAAQyC,GAAG,WAAW,MAAO,CAAC/D,EAAG,OAAO,CAACJ,EAAIU,GAAG,wBAAwB0D,OAAM,IAAO,MAAK,EAAM,YAAY,CAAChE,EAAG,MAAM,CAACA,EAAG,IAAI,CAACJ,EAAIU,GAAG,+EAA+EN,EAAG,KAAK,CAACJ,EAAIU,GAAG,WAAWV,EAAIU,GAAG,yNAAyNN,EAAG,MAAM,CAACE,YAAY,kBAAkB,CAACF,EAAG,SAAS,CAACE,YAAY,iBAAiBC,MAAM,CAAC,KAAO,UAAUC,GAAG,CAAC,MAAQR,EAAIqE,cAAc,CAACrE,EAAIU,GAAG,+BAA+BN,EAAG,SAAS,CAACE,YAAY,gBAAgBC,MAAM,CAAC,KAAO,UAAUC,GAAG,CAAC,MAAQR,EAAIsE,cAAc,CAACtE,EAAIU,GAAG,mCAAmCN,EAAG,MAAM,CAACW,IAAI,MAAMT,YAAY,SAAS,GAAGN,EAAIW,MAC53B4D,EAAkB,G,YCXlB,EAAS,WAAa,IAAIvE,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,SAAS,CAACF,EAAG,SAAS,CAACW,IAAI,QAAQT,YAAY,QAAQE,GAAG,CAAC,UAAY,SAASc,GAAgC,OAAxBA,EAAOkD,iBAAwBxE,EAAIyE,oBAAoBnD,IAAS,UAAY,SAASA,GAAgC,OAAxBA,EAAOkD,iBAAwBxE,EAAI0E,oBAAoBpD,IAAS,QAAU,SAASA,GAAgC,OAAxBA,EAAOkD,iBAAwBxE,EAAI2E,kBAAkBrD,IAAS,SAAW,SAASA,GAAgC,OAAxBA,EAAOkD,iBAAwBxE,EAAI4E,cAActD,UAC7gB,EAAkB,G,oCCCtB,SAASuD,EAAgBC,EAAUC,GACjC,KAAMD,aAAoBC,GACxB,MAAM,IAAIC,UAAU,qCAIxB,SAASC,EAAkB9B,EAAQ+B,GACjC,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CACrC,IAAIE,EAAaH,EAAMC,GACvBE,EAAWC,WAAaD,EAAWC,aAAc,EACjDD,EAAWE,cAAe,EACtB,UAAWF,IAAYA,EAAWG,UAAW,GACjDC,OAAOC,eAAevC,EAAQkC,EAAW3D,IAAK2D,IAIlD,SAASM,EAAaZ,EAAaa,EAAYC,GAG7C,OAFID,GAAYX,EAAkBF,EAAYe,UAAWF,GACrDC,GAAaZ,EAAkBF,EAAac,GACzCd,EAGT,SAASgB,EAAUC,EAAUC,GAC3B,GAA0B,oBAAfA,GAA4C,OAAfA,EACtC,MAAM,IAAIjB,UAAU,sDAGtBgB,EAASF,UAAYL,OAAOS,OAAOD,GAAcA,EAAWH,UAAW,CACrEK,YAAa,CACXzD,MAAOsD,EACPR,UAAU,EACVD,cAAc,KAGdU,GAAYG,EAAgBJ,EAAUC,GAG5C,SAASI,EAAgBC,GAIvB,OAHAD,EAAkBZ,OAAOc,eAAiBd,OAAOe,eAAiB,SAAyBF,GACzF,OAAOA,EAAEG,WAAahB,OAAOe,eAAeF,IAEvCD,EAAgBC,GAGzB,SAASF,EAAgBE,EAAGI,GAM1B,OALAN,EAAkBX,OAAOc,gBAAkB,SAAyBD,EAAGI,GAErE,OADAJ,EAAEG,UAAYC,EACPJ,GAGFF,EAAgBE,EAAGI,GAG5B,SAASC,EAAuBC,GAC9B,QAAa,IAATA,EACF,MAAM,IAAIC,eAAe,6DAG3B,OAAOD,EAGT,SAASE,EAA2BF,EAAMG,GACxC,OAAIA,GAAyB,kBAATA,GAAqC,oBAATA,EAIzCJ,EAAuBC,GAHrBG,EAMX,SAASC,EAAmBC,GAC1B,OAAOC,EAAmBD,IAAQE,EAAiBF,IAAQG,IAG7D,SAASF,EAAmBD,GAC1B,GAAIpE,MAAMC,QAAQmE,GAAM,CACtB,IAAK,IAAI9B,EAAI,EAAGkC,EAAO,IAAIxE,MAAMoE,EAAI7B,QAASD,EAAI8B,EAAI7B,OAAQD,IAAKkC,EAAKlC,GAAK8B,EAAI9B,GAEjF,OAAOkC,GAIX,SAASF,EAAiBG,GACxB,GAAIC,OAAOC,YAAY/B,OAAO6B,IAAkD,uBAAzC7B,OAAOK,UAAU2B,SAASV,KAAKO,GAAgC,OAAOzE,MAAM6E,KAAKJ,GAG1H,SAASF,IACP,MAAM,IAAIpC,UAAU,mDAGtB,IAAI2C,EAAQC,OAAOC,MAAQD,OAAOC,MAChC,CACAC,aAAc,OACdC,OAAQ,OACRC,eAAgB,OAChBC,QAAS,QAGPC,EAEJ,SAAUC,GAGR,SAASD,IACP,IAAIE,EAEAC,EAAOC,UAAUlD,OAAS,QAAsBmD,IAAjBD,UAAU,GAAmBA,UAAU,GAAK,GAC3EE,EAAaF,UAAUlD,OAAS,QAAsBmD,IAAjBD,UAAU,GAAmBA,UAAU,GAAK,GACjF9G,EAAQ8G,UAAUlD,OAAS,QAAsBmD,IAAjBD,UAAU,GAAmBA,UAAU,GAAK,yBAoBhF,OAlBAzD,EAAgB5E,KAAMiI,GAEtBE,EAAQtB,EAA2B7G,KAAMoG,EAAgB6B,GAAUnB,KAAK9G,KAAM,IAAI0H,EAAMK,eAAe,CACrGS,IAAK,IAAId,EAAMM,YAEjBG,EAAMM,MAAQ,GAAGlF,OAAO6E,GACxBD,EAAMO,YAAcH,EACpBJ,EAAMQ,OAASpH,EACf4G,EAAMS,UAAY,QAClBT,EAAMU,UAAY,GAElBV,EAAMW,YAAc,SACpBX,EAAMY,QAAUlF,SAASmF,cAAc,UACvCb,EAAMc,SAAWd,EAAMe,SAASV,IAChCL,EAAMc,SAASE,UAAYzB,EAAMG,aAEjCM,EAAMiB,aAECjB,EA8GT,OAzIArC,EAAUmC,EAAUC,GA8BpBxC,EAAauC,EAAU,CAAC,CACtBxG,IAAK,aACLgB,MAAO,WACL,IAAI4G,EAASrJ,KAETsJ,EAAStJ,KAAK+I,QACdQ,EAAMD,EAAOE,WAAW,MAExBC,EAAQzJ,KAAKyI,MAAMiB,MAAM,MAEzBC,EAAO,GAAGpG,OAAOvD,KAAK4J,WAAY,KAAKrG,OAAOvD,KAAK6J,SAAU,OAAOtG,OAAOvD,KAAK8J,UACpFP,EAAII,KAAOA,EAEXL,EAAO1H,MAAQmI,KAAKC,IAAIC,MAAMF,KAAMhD,EAAmB0C,EAAMjB,KAAI,SAAU0B,GACzE,OAAOX,EAAIY,YAAYD,GAAMtI,WAE/B0H,EAAOc,OAASpK,KAAK6J,SAAWJ,EAAMtE,OAEtCoE,EAAII,KAAOA,EACXJ,EAAIc,UAAYrK,KAAKuB,MACrBgI,EAAIe,aAAe,SACnBb,EAAMc,SAAQ,SAAUL,EAAM1I,GAC5B,OAAO+H,EAAIiB,SAASN,GAAOZ,EAAO1H,MAAQ2H,EAAIY,YAAYD,GAAMtI,OAAS,GAAIJ,EAAQ,GAAK6H,EAAOQ,aAGnG7J,KAAKiJ,SAAS/G,MAAQoH,EACtBtJ,KAAKiJ,SAASwB,aAAc,EAC5B,IAAIC,EAAS1K,KAAKuI,WAAakB,EAAMtE,OACrCnF,KAAK2K,MAAMC,IAAIF,EAASpB,EAAO1H,MAAQ0H,EAAOc,OAAQM,KAEvD,CACDjJ,IAAK,QACLgB,MAAO,WACL,OAAO,IAAIzC,KAAKkG,YAAYlG,KAAKoI,KAAMpI,KAAKuI,WAAYvI,KAAKuB,OAAOsJ,KAAK7K,QAE1E,CACDyB,IAAK,OACLgB,MAAO,SAAcqI,GAMnB,OALApD,EAAMI,OAAOjC,UAAUgF,KAAK/D,KAAK9G,KAAM8K,GACvC9K,KAAKuB,MAAQuJ,EAAOvJ,MACpBvB,KAAK8J,SAAWgB,EAAOhB,SACvB9J,KAAK6J,SAAWiB,EAAOjB,SACvB7J,KAAK4J,WAAakB,EAAOlB,WAClB5J,OAER,CACDyB,IAAK,OACLsJ,IAAK,WACH,OAAO/K,KAAKyI,OAEdmC,IAAK,SAAaxC,GAChBpI,KAAKyI,MAAQL,EAEbpI,KAAKoJ,eAEN,CACD3H,IAAK,aACLsJ,IAAK,WACH,OAAO/K,KAAK0I,aAEdkC,IAAK,SAAarC,GAChBvI,KAAK0I,YAAcH,EAEnBvI,KAAKoJ,eAEN,CACD3H,IAAK,QACLsJ,IAAK,WACH,OAAO/K,KAAK2I,QAEdiC,IAAK,SAAarJ,GAChBvB,KAAK2I,OAASpH,EAEdvB,KAAKoJ,eAEN,CACD3H,IAAK,WACLsJ,IAAK,WACH,OAAO/K,KAAK4I,WAEdgC,IAAK,SAAad,GAChB9J,KAAK4I,UAAYkB,EAEjB9J,KAAKoJ,eAEN,CACD3H,IAAK,WACLsJ,IAAK,WACH,OAAO/K,KAAK6I,WAEd+B,IAAK,SAAaf,GAChB7J,KAAK6I,UAAYgB,EAEjB7J,KAAKoJ,eAEN,CACD3H,IAAK,aACLsJ,IAAK,WACH,OAAO/K,KAAK8I,aAEd8B,IAAK,SAAahB,GAChB5J,KAAK8I,YAAcc,EAEnB5J,KAAKoJ,iBAIFnB,EA1IT,CA2IEP,EAAMI,QAEO,IC3Nf,MAAMkD,EAAc,KACdC,EAAa,GACbC,EAAa,GACbC,EAAkB,KAClBC,EAAkB,EAGlBC,EAAmB,KACnBC,EAAiB,KACjBC,EAAkB,GAClBC,EAAgB,IAAI,YAAclD,GAElCmD,EAAa,EACbC,EAAW,EACXC,EAAiB,GACjBC,GAAU,EACVC,EAAe,IAAI,OAAY,uBAC/BC,EAAgB,IAChBC,EAAgB,EAChBC,EAAY,KACZC,EAAS,EACTC,EAAe,GAEfC,EAAU,yoCA4CVC,EAAoBC,IACxB,MAAMC,EAAO,GACb,IAAK,IAAIpH,EAAI,EAAGA,EAAImH,EAAOnH,IAAK,CAC9B,MAAMqH,EAAM,6BACUrH,gDACeA,yGAGrCoH,EAAKE,KAAKD,GAEZ,OAAOD,EAAKvK,KAAK,KAGb0K,EAAWC,GAAe,2DAGJA,+WAetBN,EAAiBM,kEAOjBC,EAAiBC,GACdjF,OAAOkF,aAAeD,EAAOV,GAGhCY,EAAqBC,IACzB,MAAM1G,EAAI,IAAI,OACRgG,EAAQU,EAAIC,eAAeX,MAC3BY,EAAS,IAAI,OACbxG,EAAI,IAAI,OACRyG,EAAI,IAAI,OACRC,EAAI,IAAI,OACd,IAAK,IAAIjI,EAAI,EAAGkI,EAAK,EAAGC,EAAIhB,EAAOnH,EAAImI,EAAGnI,IAAKkI,GAAM,EAAG,CACtDL,EAAIO,YAAYpI,EAAG+H,GACnBA,EAAOM,UAAU9G,EAAG0G,EAAGD,GACvB,MAAMM,EAAI/G,EAAE+G,EACNC,EAAIhH,EAAEgH,EACNC,EAAIjH,EAAEiH,EACNC,EAAY,IAAI,OAAW,IAAI,OAA0BT,EAAEM,EAAGN,EAAEM,IACtEG,EAAUC,SAAShD,IAAI4C,EAAGC,EAAGC,EAAIR,EAAEM,GACnCnH,EAAEwH,eAAeF,GAEnB,OAAOtH,GAGHyH,EAAsBf,IAC1B,MAAM1G,EAAI,IAAI,OACRgG,EAAQU,EAAIgB,SAAS5I,OAC3B,IAAK,IAAID,EAAI,EAAGmI,EAAIhB,EAAOnH,EAAImI,EAAGnI,IAAK,CACrC,MAAM8I,EAAQjB,EAAIgB,SAAS7I,GAC3BmB,EAAEwH,eAAeG,GAEnB,OAAO3H,GAGH4H,EAAgB,CAACC,EAAGC,EAAGC,EAAGC,KAEzBH,GAAKG,EAAI,GAAK,EAAWD,EAAI,EAAKF,EAAIA,EAAIC,GACtCC,EAAI,KAAQF,GAAKA,EAAI,GAAK,GAAKC,EAGpCG,EAAmB,KACvB,MAAMC,EAAS5G,OAAO6G,WAAa7G,OAAOkF,YACpC4B,EAAS,IAAI,OACjBvD,EACAqD,EACAvD,EACAC,GAMF,OAJAwD,EAAOb,SAASJ,EAAI,EACpBiB,EAAOb,SAASH,EAAI,EACpBgB,EAAOb,SAASF,EAAIhC,EAAW,GAC/B+C,EAAOC,yBACAD,GAGHE,EAAsBtC,IAC1B,MAAMuC,EAAU,GAChB,IAAK,IAAI1J,EAAI,EAAGA,EAAImH,EAAOnH,IACzB0J,EAAQpC,KAAKhB,GAEf,OAAOoD,GAGHC,EAAa,CAACzG,EAAMoF,EAAGC,EAAGC,EAAG/C,KACjCvC,EAAOA,GAAc,cACjB0G,MAAM1G,KAAkC,IAAzBA,EAAK2G,QAAQ,SAAe3G,EAAOA,EAAKsB,MAAM,OAAO,IACxE,MAAMsF,EAAS,IAAI,EAAW5G,GAK9B,OAJA4G,EAAOlF,SAAW,YAClBkF,EAAOzG,WAAayD,EAAYrB,EAChCqE,EAAOpB,SAAShD,IAAI4C,EAAGC,EAAGC,GAC1BsB,EAAOC,OAAS,IAAI,OAAc,EAAG,GAC9BD,GAGM,QACbE,WAAY,GACZ,OACE,MAAO,CACLC,YAAY,EACZC,UAAW,KACXC,aAAc,KACdZ,OAAQ,KACRa,gBAAiB,KACjBC,UAAW,KACXC,SAAU,KACVC,OAAQ,KACRC,YAAY,EACZC,UAAU,EACVC,gBAAiB,KACjBC,WAAY,EACZC,WAAY,KACZC,UAAU,EACVC,cAAe,KACfC,eAAgB,KAChBC,YAAa,KACbC,YAAa,KACbC,WAAY,KACZC,MAAO,GACPC,iBAAkB,GAClBC,YAAa,KACbC,UAAW,KACXC,SAAU,KACVC,QAAQ,EACRC,MAAO,KACPC,iBAAkB,GAClBC,eAAgB,KAChBC,UAAW,KACXC,SAAU,KACVC,OAAQ,KACRC,aAAc,GACdC,kBAAmB,IAGvBC,SAAU,IACL,eAAW,CAAC,wBACZ,eAAS,CACV,WACA,mBACA,gBACA,eACA,aACA,gBACA,cACA,UACA,cACA,gBACA,aACA,OACA,QACA,iBAGJ,UACEnR,KAAKoR,OACLpR,KAAKqR,iBACLrR,KAAKsR,eACLtR,KAAKuR,aAAavR,KAAKqP,cACvBrP,KAAKwR,UACL7J,OAAO8J,iBAAiB,SAAUzR,KAAK0R,UACvC7N,SAAS4N,iBAAiB,WAAYzR,KAAK2R,qBAE7C,gBAEEhK,OAAOiK,oBAAoB,SAAU5R,KAAK0R,UAC1C7N,SAAS+N,oBAAoB,WAAY5R,KAAK2R,qBAEhDE,MAAO,CACL,cAAcC,GACRA,GACE9R,KAAKuP,YACPvP,KAAK+R,UAAU/R,KAAKuP,WACpBvP,KAAKgS,cAIX,UACEhS,KAAKiS,cAEP,YAAYC,GACV,GAAIA,GAASlS,KAAK6Q,eAAgB,CAChC,MAAM,WAAEnE,GAAe1M,KAAKmS,mBAC5BnS,KAAKoS,aAAa1F,GAEpB1M,KAAKiS,cAEP,KAAKI,EAAI5K,GACPzH,KAAKiQ,eAAiBqC,KAAKC,MAC3BvS,KAAKgQ,cAAgBvI,EACrBzH,KAAKkQ,YAAcmC,IAGvBG,QAAS,CACP,mBACExS,KAAKyO,OAAOgE,OAAOC,OAAO,GAC1B1S,KAAK2S,aACL3S,KAAKuR,aAAavR,KAAKqP,cACvBrP,KAAK4S,aACL5S,KAAK4Q,iBAAmB,GACxB5Q,KAAK+P,UAAW,EAChB/P,KAAK6S,OAAOC,OAAO,YAAa,OAElC,YACO9S,KAAKmQ,cACVnQ,KAAKiQ,eAAiBqC,KAAKC,MAAQzG,EACnC9L,KAAKkQ,YAAclQ,KAAKmC,OAE1B,OACEnC,KAAKyQ,SAAW,IAAI,OAAoB,CACtCsC,WAAW,EACXzJ,OAAQtJ,KAAKgT,MAAMtL,MACnBuL,gBAAiB,qBAEnBjT,KAAKyQ,SAASyC,eAAiB,OAC/BlT,KAAKyQ,SAAS0C,YAAc,IAC5BnT,KAAKyQ,SAAS2C,cAAczL,OAAO0L,kBAEnCrT,KAAKyQ,SAAS6C,QAAQ3L,OAAO6G,WAAY7G,OAAOkF,aAEhD7M,KAAK2Q,MAAQ,IAAI,OACjB3Q,KAAK2Q,MAAM4C,WAAa,IAAI,OAAY,mBAExCvT,KAAKwQ,UAAY,IAAI,OACrBxQ,KAAKqQ,MAAQ,IAAI,QAAe,MAAO,MAEvCrQ,KAAKyO,OAASH,IAGd,MAAMkF,EAAW,IAAI,QACnB,IAAI,QACDC,OAAO,GAAK,IACZC,OAAO,IAAM,IACbA,QAAQ,IAAM,IACdA,QAAQ,GAAK,IACbA,OAAO,GAAK,KAEXxK,EAAW,IAAI,OAAwB,CAC3C3H,MAAOsK,IAEH8H,EAAO,IAAI,OAAWH,EAAUtK,GACtCyK,EAAKC,SAAU,EACf5T,KAAKyP,OAASkE,EACd3T,KAAK2Q,MAAMkD,IAAI7T,KAAKyP,SAMtB,cAAcqE,GAEZ,GADA9T,KAAKyO,OAAOgE,OAAOsB,aACf/T,KAAK+P,SACP/P,KAAKyO,OAAOgE,OAAOC,OAAO,QAG5B,QAAyCpK,IAArCtI,KAAKsQ,iBAAiB0D,WAA0B,CAClDhU,KAAKyO,OAAOgE,OAAOC,OAAO,GAC1B,MAAMjR,EAAMzB,KAAKsQ,iBAAiBvD,IAAIkH,YACtCjU,KAAK6Q,eAAiB7Q,KAAKkU,MAAMzS,GACjC,MAAM+L,EAAIxN,KAAKsQ,iBAAiBvD,IAAIa,SAASJ,EACvCC,EAAIzN,KAAKsQ,iBAAiBvD,IAAIa,SAASH,EACvC0G,EAAInU,KAAKsQ,iBAAiBvD,IAAIyG,SAASY,WAAWxS,MAClDmL,EAAM,IAAI,OAAW,IAAI,OAA0BoH,EAAGA,IAC5DpH,EAAIa,SAAShD,IAAI4C,EAAGC,EAAG7B,GACvB5L,KAAKuR,aAAaxE,GAClB/M,KAAK+P,UAAW,EAChB/P,KAAKuP,UAAYxC,EACjBpF,OAAO0M,WAAW,IAAOrU,KAAKsQ,iBAAmB,GAAK,KACtDtQ,KAAK6S,OAAOC,OAAO,YAAa9S,KAAK6Q,qBAErC7Q,KAAKyO,OAAOgE,OAAOC,OAAO,IAG9B,iBACE1S,KAAKwP,SAAW,IAAI8E,EAAA,KAAkBtU,KAAKyO,OAAQzO,KAAKgT,MAAMtL,OAC9D1H,KAAKwP,SAAS+E,YAAc,EAC5BvU,KAAKwP,SAASgF,UAAY,EAC1BxU,KAAKwP,SAASiF,SAAW,GACzBzU,KAAKwP,SAASkF,YAActJ,EAC5BpL,KAAKwP,SAASmF,YAAcxJ,EAC5BnL,KAAKwP,SAASoF,aAAaC,KAAO,OAAYC,IAC9C9U,KAAKwP,SAASoF,aAAaG,MAAQ,OAAYC,OAC/ChV,KAAKwP,SAASyF,UAAW,EACzBjV,KAAKwP,SAAS0F,qBAAuB,IAEvC,aACMlV,KAAKmQ,cACPnQ,KAAK2Q,MAAMwE,OAAOnV,KAAKmQ,aACvBnQ,KAAKmQ,YAAYqD,SAAS4B,UACtBpV,KAAKmQ,YAAYjH,SAASV,KAC5BxI,KAAKmQ,YAAYjH,SAASV,IAAI4M,UAChCpV,KAAKmQ,YAAYjH,SAASkM,WAMxBpV,KAAKuQ,cACPvQ,KAAK2Q,MAAMwE,OAAOnV,KAAKuQ,aACvBvQ,KAAKuQ,YAAYiD,SAAS4B,UAC1BpV,KAAKuQ,YAAYrH,SAASV,IAAI4M,UAC9BpV,KAAKuQ,YAAYrH,SAASkM,YAG9B,mBACE,IAAKpV,KAAK6Q,eAAgB,OAC1B,MAAMwE,EAAYrV,KAAK6Q,eAAexE,MAEhCiJ,EAAkBvL,KAAKwL,IAAIlK,EAAmBE,EAAiB,GAE/DiK,EAAgBzL,KAAKwL,IAAIjK,EAAiBC,EAAiB,GAEjE,IAAIkK,EAAeC,EAEfL,EAAYC,GACdI,EAAYpK,EACZmK,EAAgBD,IAEhBE,EAAYrK,EACZoK,EAAgBH,GAGlB,MAAMK,EAAeD,EAAYnK,EAE3BmB,EAAa3C,KAAK6L,KAAKP,EAAYI,GAEzC,MAAO,CACLE,eACAF,gBACAC,YACAhJ,eAGJ,aAAaA,GACX,IAAImJ,GAAgB,EAEhBjH,EAAU5O,KAAK4O,QAAQ5O,KAAK8V,cAAcrU,KAC9C,GAAImN,GAAWA,EAAQzJ,SAAWuH,EAChCmJ,GAAgB,MACX,CACLjH,EAAUD,EAAmBjC,GAE7B,MAAMqJ,EAAS/V,KAAK8V,cACpB9V,KAAKgW,kBAAkB,CAAED,SAAQrJ,eAEnC,MAAO,CAAEkC,UAASiH,kBAEpB,aACE,GAAK7V,KAAKmQ,aACLnQ,KAAK8V,cACV,GAAK9V,KAAKiW,aAUH,GAAIjW,KAAK4O,QAAQ5O,KAAK8V,cAAcrU,KAAM,CAC/C,MAAMuF,EAAM,GACVkP,EAAalW,KAAK4O,QAAQ5O,KAAK8V,cAAcrU,KAC/C,IAAK,IAAIyD,EAAI,EAAGA,EAAIiR,OAAOC,kBAAmBlR,IAAK,CACjD,IAAIgR,EAAWhR,GACV,MADc8B,EAAIwF,KAAK0J,EAAWhR,IAGzClF,KAAKmQ,YAAYjH,SAASmN,SAASC,QAAQ7T,MAAQuE,EACnDhH,KAAKmQ,YAAYjH,SAASmN,SAASC,QAAQ7L,aAAc,EACzDzK,KAAKmQ,YAAYjH,SAASmN,SAASR,cAAcpT,MAAQ,EACzDzC,KAAKmQ,YAAYjH,SAASmN,SAASR,cAAcpL,aAAc,EAC/DzK,KAAKmQ,YAAYjH,SAASmN,SAASJ,YAAYxT,MAAQ,EACvDzC,KAAKmQ,YAAYjH,SAASmN,SAASJ,YAAYxL,aAAc,OAtBxC,CAErB,MAAM,WAAEiC,GAAe1M,KAAKmS,mBACtBvD,EAAUD,EAAmBjC,GACnC1M,KAAKmQ,YAAYjH,SAASmN,SAASC,QAAQ7T,MAAQmM,EACnD5O,KAAKmQ,YAAYjH,SAASmN,SAASC,QAAQ7L,aAAc,EACzDzK,KAAKmQ,YAAYjH,SAASmN,SAASR,cAAcpT,MAAQ,EACzDzC,KAAKmQ,YAAYjH,SAASmN,SAASR,cAAcpL,aAAc,EAC/DzK,KAAKmQ,YAAYjH,SAASmN,SAASJ,YAAYxT,MAAQ,EACvDzC,KAAKmQ,YAAYjH,SAASmN,SAASJ,YAAYxL,aAAc,IAgBjE,UAAUsC,GACR/M,KAAK2S,aAEL,MAAM0C,EAAYrV,KAAK6Q,eAAexE,MAEhCO,EAAO7C,KAAK6L,KAAK7L,KAAKwM,KAAKlB,IAC3BlB,EAAIpH,EAAIyG,SAASY,WAAWxS,MAC5B4U,EAAWrC,EAAIvH,EACf6J,EAAQtC,EAERX,EAAW,IAAI,QAEf,aACJmC,EAAY,cACZF,EAAa,UACbC,EAAS,WACThJ,GACE1M,KAAKmS,mBAET,IAAIvD,EAAU,GACZiH,GAAgB,EAClB,GAAI7V,KAAKiW,YAAa,CACpB,MAAMS,EAAU1W,KAAKoS,aAAa1F,GAClCkC,EAAU8H,EAAQ9H,QAClBiH,EAAgBa,EAAQb,mBAExBjH,EAAUD,EAAmBjC,GAG/B,MAAMxD,EAAW,IAAI,OAAwB,CAC3CyN,aAAcxK,EACdyK,eAAgBnK,EAAQC,GACxB2J,SAAU,CACRR,cAAe,CACbgB,KAAM,IACNpU,MAAOoT,EAAgB,EAAM,GAE/BI,YAAa,CACXY,KAAM,IACNpU,MAAOzC,KAAKiW,YAAc,EAAM,GAElCK,QAAS,CACPO,KAAM,IACNpU,MAAOmM,GAETkI,QAAS,CACPD,KAAM,IACNpU,MAAOiT,GAETqB,OAAQ,CACNF,KAAM,IACNpU,MAAO8I,GAETyL,WAAY,CACVH,KAAM,IACNpU,MAAOkK,EAAcC,KAGzBqK,WAAW,EACXC,aAAa,EACbC,cAAc,IAGVC,EAAM,IAAIC,aAAyB,EAAZhC,GACvBiC,EAAW,IAAID,aAAahC,GAElC,IAAK,IAAInQ,EAAI,EAAGA,EAAImQ,EAAWnQ,IAAK,CAClC,MAAMqS,EAAYxN,KAAKyN,MAAMtS,EAAIuQ,GAC3BgC,EAAIvS,EAAIuQ,EACRjI,EAAIiK,EAAI9B,EACRlI,EAAI1D,KAAKyN,MAAMC,EAAI9B,GACzByB,EAAQ,EAAJlS,GAASsI,EACb4J,EAAQ,EAAJlS,EAAQ,GAAKuI,EACjB6J,EAASpS,GAAKqS,EAGhB/D,EAASkE,aAAa,KAAM,IAAI,OAAsBN,EAAK,GAAG,IAE9D,MAAMO,EAAQ,IAAIN,aAAahC,GAAWuC,KAAKzD,GAC/CX,EAASkE,aAAa,OAAQ,IAAI,OAAsBC,EAAO,IAE/DnE,EAASkE,aAAa,YAAa,IAAI,OAAsBJ,EAAU,IAEvE9D,EAASkE,aACP,QACA,IAAI,OAA6B1X,KAAK6X,cAAe,IAGvD7X,KAAKmQ,YAAc,IAAI,OAAaqD,EAAUtK,GAC9ClJ,KAAKmQ,YAAY2H,eAAgB,EACjC9X,KAAKmQ,YAAYsC,OAAO7H,IAAI,GAG5B,MAAMmN,EAAepJ,EAAmB,GAAG,GACrCqJ,EAAgB,IAAI,OAAwB,CAChDC,QAAS,EACTf,aAAa,EACb1O,IAAKuP,IAEDG,EAAkB,IAAI,OAA0BzB,EAAOA,EAAO,EAAG,GACvEzW,KAAKuQ,YAAc,IAAI,OAAW2H,EAAiBF,GACnDhY,KAAKuQ,YAAYkC,OAAO7H,IAAI,GAC5B5K,KAAKuQ,YAAY3C,SAASJ,EAAIT,EAAIa,SAASJ,EAC3CxN,KAAKuQ,YAAY3C,SAASH,EAAIV,EAAIa,SAASH,EAC3CzN,KAAKuQ,YAAY3C,SAASF,EAAIX,EAAIa,SAASF,EAC3C1N,KAAK2Q,MAAMkD,IAAI7T,KAAKuQ,aAGpBvQ,KAAKmQ,YAAYgI,IAAM,CACrB1B,QACA7J,OACA4J,WACAnB,YACA7H,EAAGT,EAAIa,SAASJ,EAChBC,EAAGV,EAAIa,SAASH,EAChBC,EAAGX,EAAIa,SAASF,GAGlB1N,KAAK2Q,MAAMkD,IAAI7T,KAAKmQ,cAEtB,mBACE,IAAKnQ,KAAKmQ,cAAgBnQ,KAAKiQ,eAAgB,OAC/C,MAAM/B,EAAIoE,KAAKC,MAAQvS,KAAKiQ,eAC5B,IAAIxI,EAAM4K,EACV,OAAQrS,KAAKgQ,eACX,IAAK,UACHvI,EAAOzH,KAAKoY,iBACZ,MACF,IAAK,MACH3Q,EAAOzH,KAAKqY,aACZ,MACF,IAAK,UACH5Q,EAAOzH,KAAKsY,cACZ,MAEJ,OAAQtY,KAAKkQ,aACX,IAAK,UACHmC,EAAKrS,KAAKoY,iBACV,MACF,IAAK,MACH/F,EAAKrS,KAAKqY,aACV,MACF,IAAK,UACHhG,EAAKrS,KAAKsY,cACV,MAEApK,GAAKpC,IACPrE,EAAO4K,EACPrS,KAAKiQ,eAAiB,MAGxB,MAAM,MAAEwG,EAAK,UAAEpB,EAAS,SAAEmB,EAAQ,KAAE5J,GAAS5M,KAAKmQ,YAAYgI,IACxD3K,EAAIxN,KAAKmQ,YAAYgI,IAAI3K,EAAY,GAARiJ,EAAyB,GAAXD,EAC3C/I,EAAIzN,KAAKmQ,YAAYgI,IAAI1K,EAAY,GAARgJ,EAAyB,GAAXD,EAC3C9I,EAAI1N,KAAKmQ,YAAYgI,IAAIzK,EAEzB6K,EAAU9B,EAAQ7J,EAClB4L,EAAY,IAAInB,aAAyB,EAAZhC,GAC7BzH,EAAW,IAAI,OAErB,IAAK,IAAI1I,EAAI,EAAGkI,EAAK,EAAGC,EAAIgI,EAAWnQ,EAAImI,EAAGnI,IAAKkI,GAAM,EAAG,CAC1D,MAAMqL,EAAKhR,EAAK2F,GACVsL,EAAKjR,EAAK2F,EAAK,GACfuL,EAAKlR,EAAK2F,EAAK,GACfwL,EAAKvG,EAAGjF,GACRyL,EAAKxG,EAAGjF,EAAK,GACb0L,EAAKzG,EAAGjF,EAAK,GACnB,IAAI2L,EAAK9K,EAAcC,EAAGuK,EAAIG,EAAKH,EAAI3M,GACnCkN,EAAK/K,EAAcC,EAAGwK,EAAIG,EAAKH,EAAI5M,GACnCmN,EAAKhL,EAAcC,EAAGyK,EAAIG,EAAKH,EAAI7M,GAEvCiN,EAAKvL,EAAIuL,EAAKR,EACdS,EAAKvL,EAAIuL,GAAMT,EACfU,EAAKvL,EAAIuL,EACTrL,EAAShD,IAAImO,EAAIC,EAAIC,GACrBrL,EAASsL,QAAQV,EAAWpL,GAE9BpN,KAAKmQ,YAAYqD,SAASkE,aACxB,WACA,IAAI,OAA6Bc,EAAW,KAGhD,eACExY,KAAKmZ,eAEL,MAAMC,EAAU5T,OAAO6T,OAAOrZ,KAAKkU,OAAOoF,OAAQnL,GAAMA,EAAE9B,MAAQ,GAClE+M,EAAQjX,KAAK,CAACoX,EAAGpL,IAAMA,EAAE9B,MAAQkN,EAAElN,OAEnC,MAAMmN,EAAcJ,EAAQjU,OACtBsU,EAAS,IAAIpC,aAA2B,EAAdmC,GAC1BjY,EAAQ,IAAI,OACZ8N,EAAe,IAAI,OACnByB,EAAY,IAAI,OAChBlE,EAAO7C,KAAK6L,KAAK7L,KAAKwM,KAAKiD,IAC3BE,GAAQ,EACRC,EAAO,EACPC,EAAQ,EACRrB,EAAUqB,EAAQhN,EAExB,IAAK,IAAI1H,EAAI,EAAGkI,EAAK,EAAGC,EAAImM,EAAatU,EAAImI,EAAGnI,IAAKkI,GAAM,EAAG,CAC5D,MAAMe,EAAIiL,EAAQlU,GACZmH,EAAQ8B,EAAE9B,MACVjE,EAAO+F,EAAE5L,KACTsX,EAAMxN,EAAQrM,KAAK8Z,WACnBnP,EAAQ3K,KAAK0Q,OAAS3G,KAAKwM,KAAKsD,GAAOpO,EACvC0I,GAAKoE,EAAUA,EAAU5M,GAAkBhB,EAC3C6C,EAAIkM,EAAQxU,EAAI0H,EAAQ2L,EACxB9K,EAAIkM,EAAO5P,KAAKyN,MAAMtS,EAAI0H,GAAQ2L,EAClC7K,EAAIhC,EAEVnK,EAAMwY,OAAO,IAAc7U,EAAImI,EAAX,GAAe,EAAK,IACxC9L,EAAM2X,QAAQO,EAAY,EAAJvU,GAGtB,MAAMsO,EAAW,IAAI,OAA0BW,EAAGA,GAC5C6F,EAAM7L,EAAE8L,OAAOlQ,KAAKyN,MAAMzN,KAAKmQ,SAAW/L,EAAE8L,OAAO9U,SACnDmR,GAAU,IAAI,QAAsB6D,KAAKH,GAC/C1D,EAAQ8D,SAAW,OACnB,MAAMlR,EAAW,IAAI,OAAwB,CAC3CV,IAAK8N,EACL/U,MAAO,WAEHoS,EAAO,IAAI,OAAWH,EAAUtK,GACtCyK,EAAKM,YAAc9F,EAAE1M,IACrBkS,EAAK/F,SAAShD,IAAI4C,EAAGC,EAAGC,GACxB2B,EAAawE,IAAIF,GAGjB,MAAM0G,EAAU5M,EAAI0G,EAAI,EAClBmG,EAAQ5O,EAAWO,EAAStB,EAC5B4P,EAAWnS,EACXoS,EAAYnO,EAClByE,EAAU+C,IACRhF,EACE,GAAG0L,EAASE,mBAAkB,IAAIC,KAAKC,cAAeC,OACpDJ,KAEFhN,EAAI2G,EAAI,EACRkG,EACAC,EACA3P,IAKN3K,KAAKqP,aAAeA,EAEpBrP,KAAK8Q,UAAYA,EAEjB9Q,KAAK2Q,MAAMkD,IAAI7T,KAAKqP,cACpBrP,KAAK2Q,MAAMkD,IAAI7T,KAAK8Q,YAEtB,eACO9Q,KAAKqP,eACVrP,KAAK8Q,UAAU/C,SAASxD,QAAS2D,GAAMA,EAAEhF,SAASV,IAAI4M,WACtDpV,KAAKqP,aAAatB,SAASxD,QAAS2D,IAClCA,EAAEsF,SAAS4B,UACXlH,EAAEhF,SAASV,IAAI4M,YAEjBpV,KAAK2Q,MAAMwE,OAAOnV,KAAKqP,cACvBrP,KAAK2Q,MAAMwE,OAAOnV,KAAK8Q,aAEzB,aAAa/D,GACX,IAAI1G,EAGFA,EADE0G,aAAe,OACbD,EAAkBC,GACbA,aAAe,OAEpBe,EAAmBf,IAEnB,IAAI,QAAa8N,cAAc9N,GAGrC,MAAM+N,EAAS,IAAI,OACnBzU,EAAE0U,kBAAkBD,GACpB,MAAMlO,EAAOkO,EAAOE,OAASjP,EAEvBkD,EAAS,IAAI,OACnB5I,EAAE4U,UAAUhM,GAEZ,MAAMiM,EAAMhQ,GAAcnB,KAAKoR,GAAK,KAC9BC,EAAOrR,KAAKsR,IAAIzO,EAAO7C,KAAKuR,IAAIJ,EAAM,IAEtCK,EAAM,IAAI,OAAc,EAAG,EAAG,GAC9BC,GAAS,IAAI,QAAgBC,WAAWxM,EAAQsM,EAAIG,UAAUN,IAEpEpb,KAAKoQ,WAAapQ,KAAKyO,OAAOkN,QAC9B3b,KAAK+Q,SAAW/Q,KAAKyO,OAAOkN,QAC5B3b,KAAK+Q,SAASnD,SAAS/C,KAAK2Q,GAC5Bxb,KAAKgR,OAAS/B,EAEdjP,KAAKsP,gBAAkBgD,KAAKC,MAC5BvS,KAAK2P,UAAW,GAElB,oBACE,IAAK3P,KAAKoQ,WAAY,OACtB,MAAMlC,EAAIoE,KAAKC,MAAQvS,KAAKsP,gBAEtBmJ,EAAKzY,KAAKoQ,WAAWxC,SAASJ,EAC9BkL,EAAK1Y,KAAKoQ,WAAWxC,SAASH,EAC9BkL,EAAK3Y,KAAKoQ,WAAWxC,SAASF,EAC9BkL,EAAK5Y,KAAK+Q,SAASnD,SAASJ,EAC5BqL,EAAK7Y,KAAK+Q,SAASnD,SAASH,EAC5BqL,EAAK9Y,KAAK+Q,SAASnD,SAASF,EAC5B8N,EAAS,IAAI,OACnBA,EAAOhO,EAAIS,EAAcC,EAAGuK,EAAIG,EAAKH,EAAI3M,GACzC0P,EAAO/N,EAAIQ,EAAcC,EAAGwK,EAAIG,EAAKH,EAAI5M,GACzC0P,EAAO9N,EAAIO,EAAcC,EAAGyK,EAAIG,EAAKH,EAAI7M,GACzC9L,KAAKyO,OAAOb,SAAS/C,KAAK2Q,GAE1B,MAAMI,EAAK5b,KAAKwP,SAAStM,OAAOyY,QAC1BE,EAAK7b,KAAKgR,OAAO2K,QACjB1M,EAAS,IAAI,OACnBA,EAAOzB,EAAIS,EAAcC,EAAG0N,EAAGpO,EAAGqO,EAAGrO,EAAIoO,EAAGpO,EAAG1B,GAC/CmD,EAAOxB,EAAIQ,EAAcC,EAAG0N,EAAGnO,EAAGoO,EAAGpO,EAAImO,EAAGnO,EAAG3B,GAC/CmD,EAAOvB,EAAIO,EAAcC,EAAG0N,EAAGlO,EAAGmO,EAAGnO,EAAIkO,EAAGlO,EAAG5B,GAC/C9L,KAAKwP,SAAStM,OAAO2H,KAAKoE,GAEtBf,EAAIpC,IACN9L,KAAKyO,OAAOb,SAAS/C,KAAK7K,KAAK+Q,SAASnD,UACxC5N,KAAKwP,SAAStM,OAAO2H,KAAK7K,KAAKgR,QAC/BhR,KAAKoQ,WAAa,KAClBpQ,KAAK+Q,SAAW,KAChB/Q,KAAK2P,UAAW,IAGpB,UACEmM,sBAAsB9b,KAAKwR,SAC3BxR,KAAK+b,oBACL/b,KAAKgc,mBACLhc,KAAKwP,SAASyM,SACdjc,KAAKF,UAEP,WACE,MAAMqU,EAAIxM,OAAO6G,WACX0N,EAAIvU,OAAOkF,YAIjB,GAHA7M,KAAKyQ,SAAS6C,QAAQa,EAAG+H,GACzBlc,KAAKyO,OAAOF,OAAS4F,EAAI+H,EACzBlc,KAAKyO,OAAOC,yBACR1O,KAAKmQ,YAAa,CACpB,MAAM,KAAEvD,GAAS5M,KAAKmQ,YAAYgI,IAClCnY,KAAKmQ,YAAYjH,SAASmN,SAASW,WAAWvU,MAAQkK,EACpDC,GAEF5M,KAAKmQ,YAAYjH,SAASmN,SAASW,WAAWvM,aAAc,IAGhE,mBAAmB0R,GACjBnc,KAAK8P,WAAa,MAEpB,kBAAkBqM,GAChBnc,KAAKmP,YAAa,EAClB,MAAMiN,EAAQpc,KAAKoP,UAAUiN,QACvBC,EAAQtc,KAAKoP,UAAUmN,QAEvBC,EAAOL,EAAME,QACbI,EAAON,EAAMI,QAEbG,EAAU3S,KAAKsR,IAAImB,EAAOJ,GAAS,GAAKrS,KAAKsR,IAAIoB,EAAOH,GAAS,EAEvE,GAAKI,IAEL1c,KAAKyO,OAAOgE,OAAOsB,cACf/T,KAAK2P,UACT,OAAI3P,KAAK+P,UACP/P,KAAKyO,OAAOgE,OAAOC,OAAO,aACepK,IAArCtI,KAAKsQ,iBAAiB0D,aAiBxBhU,KAAK0P,YAAa,EAClB1P,KAAKuR,aAAavR,KAAKsQ,iBAAiBvD,KACxC/M,KAAK2c,wBAIgCrU,IAArCtI,KAAKsQ,iBAAiB0D,YAExBhU,KAAKyO,OAAOgE,OAAOC,OAAO,GAExB1S,KAAKsQ,iBAAiB0D,aAAehU,KAAK4Q,iBAAiBoD,aAE3DhU,KAAK4S,aACL5S,KAAKuR,aAAavR,KAAKsQ,iBAAiBvD,KACxC/M,KAAK4Q,iBAAmB,IAAK5Q,KAAKsQ,mBAEpCtQ,KAAK6S,OAAOC,OAAO,YAAa,OAEhC9S,KAAK4c,qBAGT,oBAAoBT,GAClBnc,KAAKwE,oBAAoB2X,GACzBnc,KAAKmP,YAAa,EAClBnP,KAAKoP,UAAY+M,GAEnB,oBAAoBA,GAClBnc,KAAKqQ,MAAM7C,EAAK2O,EAAME,QAAU1U,OAAO6G,WAAc,EAAI,EACzDxO,KAAKqQ,MAAM5C,GAAM0O,EAAMI,QAAU5U,OAAOkF,YAAe,EAAI,GAE7D,aACE7M,KAAKyP,OAAOmE,SAAU,GAExB,SACE5T,KAAKyQ,SAAS3Q,OAAOE,KAAK2Q,MAAO3Q,KAAKyO,QAClCzO,KAAKgT,MAAMtL,OAAO1H,KAAKgT,MAAMtL,MAAMmV,UAAU1H,OAAO,WAEpDnV,KAAKqQ,OAAOrQ,KAAKwQ,UAAUsM,cAAc9c,KAAKqQ,MAAOrQ,KAAKyO,QAE9DzO,KAAK+c,aACL/c,KAAKgd,YAEP,UAAUC,GACR,IAAKjd,KAAK8V,cAAe,OACzB,MAAM,EAAEtI,EAAC,EAAEC,GAAMwP,GACX,MAAExG,EAAK,KAAE7J,EAAI,UAAEyI,GAAcrV,KAAKmQ,YAAYgI,IAC9C+E,EAAKld,KAAKmQ,YAAYgI,IAAI3K,EAC1B2P,EAAKnd,KAAKmQ,YAAYgI,IAAI1K,EAC1B2P,EAAMrT,KAAKyN,MAAM5K,EAAOY,GACxB6P,EAAMtT,KAAKyN,MAAM5K,GAAQ,EAAIa,IAC7B6P,EAAO,EAAI1Q,EACXoM,EAAK,EAAIvL,EACT8P,EAAOH,EAAME,EAAQA,EAAOpR,EAAgB,EAC5CsR,EAAOJ,EAAME,EAAOA,EAAQA,EAAOpR,EAAgB,EACnDuR,EAAOJ,EAAMC,EAAQA,EAAOpR,EAAgB,EAC5CwR,EAAOL,EAAMC,EAAOA,EAAQA,EAAOpR,EAAgB,EAEnD1K,EAAQ4b,EAAMC,EAAMzQ,EAC1B,GAAIY,EAAI+P,GAAQ/P,EAAIgQ,GAAQxE,EAAKyE,GAAQzE,EAAK0E,EAAM,CAClD,IAAIC,EACJ,OAAQ3d,KAAKmC,MACX,IAAK,UACHwb,EAAS3d,KAAK8V,cAAc8H,IAAIpc,GAChC,MACF,IAAK,MACHmc,EAAS3d,KAAK8V,cAAc8H,IAAI5d,KAAK6d,WAAWrc,IAChD,MACF,IAAK,UAEHmc,EAAS3d,KAAK8V,cAAc8H,IAAI5d,KAAK8d,YAAYtc,IACjD,MAEJ,IAAKmc,EAAQ,OAAO,KACpB,MAAM3J,EAAaxS,EACbuc,EAAcX,EAAME,EAAO7G,EAC3BuH,EAAcX,EAAMC,EAAO7G,EAC3BwH,EAAoB,GAARxH,EACZyH,EAA4B,GAAPZ,EAAa7G,EAClC0H,EAAKjB,EAAKa,EAAcE,EAAYC,EACpCE,EAAKjB,EAAKa,EAAcC,EAAYC,EAC1C,MAAO,CAAElK,aAAY2J,SAAQQ,KAAIC,MAEnC,OAAO,MAET,WACE,GAAIpe,KAAKuQ,aAAevQ,KAAK+P,SAAU,CACrC,MAAMsO,EAAare,KAAKwQ,UAAU8N,gBAAgBte,KAAKuQ,aAEvD,GAAI8N,EAAWlZ,OAAS,GAAKkZ,EAAW,GAAGpB,GAAI,CAC7C,MAAMsB,EAAOve,KAAKwe,UAAUH,EAAW,GAAGpB,IAC1C,GAAIsB,EAAM,CACR,MAAM,WAAEvK,EAAU,OAAE2J,EAAM,GAAEQ,EAAE,GAAEC,GAAOG,EAEvC,GADIve,KAAKgT,MAAMtL,OAAO1H,KAAKgT,MAAMtL,MAAMmV,UAAUhJ,IAAI,WACjD7T,KAAKsQ,iBAAiB0D,aAAeA,EAAY,CAEnD,MAAM,SAAEwC,GAAaxW,KAAKmQ,YAAYgI,IAEhCsG,EAAQJ,EAAW,GAAGI,MAEtBjL,EAAW,IAAI,OACR,EAAXgD,EACW,EAAXA,GAEItN,EAAW,IAAI,OACf6D,EAAM,IAAI,OAAWyG,EAAUtK,GACrC6D,EAAIa,SAASJ,EAAI2Q,EACjBpR,EAAIa,SAASH,EAAI2Q,EACjBrR,EAAIa,SAASF,EAAI+Q,EAAM/Q,EACvB1N,KAAKsQ,iBAAiB0D,WAAaA,EACnChU,KAAKsQ,iBAAiBvD,IAAMA,EAC5B/M,KAAKsQ,iBAAiBqN,OAASA,QAG7B3d,KAAKgT,MAAMtL,OAAO1H,KAAKgT,MAAMtL,MAAMmV,UAAU1H,OAAO,WACxDnV,KAAKsQ,iBAAmB,QAEjBtQ,KAAKsQ,iBAAiB0D,aAC3BhU,KAAKgT,MAAMtL,OAAO1H,KAAKgT,MAAMtL,MAAMmV,UAAU1H,OAAO,WACxDnV,KAAKsQ,iBAAmB,MAI9B,WAEE,IAAKtQ,KAAKsQ,iBAAiBqN,OAEzB,YADA3d,KAAK8P,WAAa,MAGpB,MAAM6N,EAAS3d,KAAKsQ,iBAAiBqN,OACjCA,IAAW3d,KAAK8P,aACpB9P,KAAK8P,WAAa6N,EAClB3d,KAAK6S,OAAOC,OAAO,cAAe,IAClC9S,KAAK6S,OAAO6L,SAAS,WAAYf,KAEnC,aACE,GAAI3d,KAAKqP,eAAiBrP,KAAK+P,SAAU,CACvC,MAAMsO,EAAare,KAAKqP,aAAatB,SAClCvF,IAAKmW,GAAO3e,KAAKwQ,UAAU8N,gBAAgBK,IAC3CrF,OAAQqF,GAAOA,EAAGxZ,OAAS,GAC3BqD,IAAKmW,GAAOA,EAAG,IAElB,GAAIN,EAAWlZ,OAAS,EAAG,CACrBnF,KAAKgT,MAAMtL,OAAO1H,KAAKgT,MAAMtL,MAAMmV,UAAUhJ,IAAI,WACrD,MAAM9G,EAAMsR,EAAW,GAAGO,OACpB5K,EAAajH,EAAIkH,YACvB,GAAIjU,KAAKsQ,iBAAiB0D,aAAeA,EAAY,CAEjDhU,KAAK4Q,iBAAiBoD,aACtBhU,KAAKsQ,iBAAiB0D,YAEtBhU,KAAK4S,aAGP5S,KAAKsQ,iBAAiB0D,WAAaA,EACnChU,KAAKsQ,iBAAiBvD,IAAMA,EAC5B,MAAMoH,EAAIpH,EAAIyG,SAASY,WAAWxS,MAClC5B,KAAKyP,OAAO7B,SAASJ,EAAIT,EAAIa,SAASJ,EACtCxN,KAAKyP,OAAO7B,SAASH,EAAIV,EAAIa,SAASH,EAAQ,GAAJ0G,EAAc,IAAJA,EACpDnU,KAAKyP,OAAO7B,SAASF,EAAIX,EAAIa,SAASF,EACtC1N,KAAKyP,OAAO9E,MAAQ,IAAI,OAAkB,KAAJwJ,EAAc,GAAJA,EAASA,GACzDnU,KAAKyP,OAAOmE,SAAU,QAEf5T,KAAKsQ,iBAAiB0D,aAC/BhU,KAAK4S,aACL5S,KAAKsQ,iBAAmB,SAI3B,eAAW,CAAC,wBCzgCyK,M,yBCQxLuO,GAAY,gBACd,GACA,EACA,GACA,EACA,KACA,WACA,MAIa,GAAAA,G,QC8Gf,MAAMC,GAAiB,iDAER,QACb5P,WAAY,CAAE6P,QACd,OACE,MAAO,CACLjc,WAAY9C,KAAKiW,YACjBhU,aAAc6c,GACd1d,YAAY,IAGhByQ,MAAO,CACL,OAAOQ,GACL,MAAMlQ,EAAOkQ,EAAGhQ,MAAMF,KAAOkQ,EAAGhQ,MAAMF,KAAO,UACzCA,IAASnC,KAAKmC,MAAMnC,KAAK6S,OAAOC,OAAO,UAAW3Q,IAExD,SAAS6c,GACHA,EAAQ7d,KAAInB,KAAKoB,YAAa,KAGtCoR,QAAS,CACP,OACExS,KAAKgT,MAAMiM,IAAIrC,oBAEjB,cACE5c,KAAK8C,YAAa,EAClB9C,KAAK6S,OAAOC,OAAO,qBAAqB,GACxC9S,KAAK6S,OAAOC,OAAO,kBAAkB,GACjC9S,KAAKkf,QAAQlf,KAAKkf,OAAOC,QAE/B,cACEnf,KAAK8C,YAAa,EAClB9C,KAAK6S,OAAOC,OAAO,qBAAqB,GACxC9S,KAAK6S,OAAOC,OAAO,kBAAkB,GACjC9S,KAAKkf,QAAQlf,KAAKkf,OAAOC,QAE/B,eACMnf,KAAK8C,aAAe9C,KAAKof,eACvBpf,KAAKkf,QAAQlf,KAAKkf,OAAOG,OAE7Brf,KAAK6S,OAAOC,OAAO,iBAAkB9S,KAAK8C,aAG9C,gBAAgBoc,GACdlf,KAAKkf,OAASA,EACdlf,KAAKkf,OAAO3e,GAAG,OAAQ,KAChBP,KAAKof,iBACRpf,KAAK8C,YAAc9C,KAAK8C,gBAKhCqO,SAAU,CACR,cACE,MAAM9D,EAAI7H,OAAO6T,OAAOrZ,KAAKkU,OAAO/O,OACpC,OAAOnF,KAAK8V,cAC2B,KAAnC9V,KAAK8V,cAAcjV,YACjBb,KAAK8V,cAAcjV,YAAYye,OAC/B,GACF9Z,OAAO6T,OAAOrZ,KAAKkU,OAChBoF,OAAQnL,GAAMA,EAAE9B,MAAQ,GACxB7D,IAAI,CAAC0E,EAAG1L,IAAWA,IAAU6L,EAAI,EAAI,OAASH,EAAE3K,KAAO2K,EAAE3K,MACzDR,KAAK,OAEd,QACE,OAAO/B,KAAK8Z,YAEd,sBACE,MAAO,IAAG,IAAIY,KAAKC,cAAeC,OAChC5a,KAAK8V,cAAgB9V,KAAK8V,cAAczJ,MAAQrM,KAAKuf,oBAErDvf,KAAK8V,cACD,IACA9V,KAAK8V,cAAcvT,KAAK+c,QACY,KAAnCtf,KAAK8V,cAAcjV,YAAqB,IAAM,IAC/C,UAGL,eAAW,CAAC,wBACZ,eAAS,CACV,WACA,iBACA,iBACA,SACA,aACA,QACA,gBACA,OACA,iBAGJ,UACEb,KAAK6S,OAAOC,OAAO,UAAW9S,KAAKwf,OAAOnd,MAAMF,MAChDnC,KAAK6S,OAAOC,OAAO,gBC9NwK,MCS3L,I,oBAAY,gBACd,GACAhT,EACAwE,GACA,EACA,KACA,WACA,OAIa,gB,2CCpBf,yBAAmiB,EAAG,G,kCCAtiB,yBAAgiB,EAAG","file":"js/three.067cc423.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=style&index=1&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=style&index=1&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.loaded)?_c('div',{staticClass:\"grid\",attrs:{\"id\":\"viewer\"}},[_c('div',{staticClass:\"header\"},[_c('h1',{staticClass:\"total\"},[(_vm.currentBucket)?_c('p',[_c('button',{staticClass:\"button-back\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.back}},[_vm._v(\" < back to everything \")])]):_vm._e(),_c('strong',[_vm._v(_vm._s(_vm.formattedItemsTotal))]),_vm._v(\" \"+_vm._s(_vm.description)+\" \")])]),_c('div',{ref:\"file\",class:{ file: true, hidden: !_vm.fileData.id || _vm.fileHidden }},[_c('button',{staticClass:\"button-hide\",attrs:{\"type\":\"button\"},on:{\"click\":function($event){_vm.fileHidden = true}}},[_vm._v(\" hide \")]),(_vm.fileData.palette)?_c('div',{staticClass:\"palette\"},_vm._l((_vm.fileData.palette),function(color,index){return _c('span',{key:index,staticClass:\"color\",style:({\n          backgroundColor: color.color,\n          width: color.percent * 100 + '%'\n        }),attrs:{\"title\":_vm.fileData.colorNames[index].join(', ')}})}),0):_vm._e(),(!_vm.fileData.title)?_c('div',{staticClass:\"loading\"},[_vm._v(\"Loading...\")]):_vm._e(),_c('a',{attrs:{\"href\":_vm.filesBaseUrl + '/' + _vm.fileData.id,\"rel\":\"noopener\",\"target\":\"_blank\"}},[(_vm.fileData.image)?_c('img',{staticClass:\"thumbnail\",attrs:{\"src\":_vm.fileData.image,\"alt\":_vm.fileData.title,\"title\":_vm.fileData.title}}):_vm._e()]),(_vm.fileData.title)?_c('p',{staticClass:\"file-description\"},[_c('a',{attrs:{\"href\":_vm.filesBaseUrl + '/' + _vm.fileData.id,\"rel\":\"noopener\",\"target\":\"_blank\"}},[_vm._v(\" \"+_vm._s(_vm.fileData.title)+\" \")])]):_vm._e()]),_c('div',{staticClass:\"controls\"},[_c('div',{staticClass:\"sort\"},[_c('router-link',{class:['button-sort', _vm.sort === 'default' ? 'active' : ''],attrs:{\"to\":{ path: '/' }}},[_vm._v(\" default \")]),_c('router-link',{class:['button-sort', _vm.sort === 'hue' ? 'active' : ''],attrs:{\"to\":{ path: '/', query: { sort: 'hue' } }}},[_vm._v(\" color \")]),_c('router-link',{class:['button-sort', _vm.sort === 'similar' ? 'active' : ''],attrs:{\"to\":{ path: '/', query: { sort: 'similar' } }}},[_vm._v(\" similarity \")])],1),_c('div',{staticClass:\"atlas\"},[_c('label',{attrs:{\"for\":\"atlas\"}},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.atlasShown),expression:\"atlasShown\"}],attrs:{\"type\":\"checkbox\",\"id\":\"atlas\"},domProps:{\"checked\":Array.isArray(_vm.atlasShown)?_vm._i(_vm.atlasShown,null)>-1:(_vm.atlasShown)},on:{\"change\":[function($event){var $$a=_vm.atlasShown,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.atlasShown=$$a.concat([$$v]))}else{$$i>-1&&(_vm.atlasShown=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.atlasShown=$$c}},_vm.confirmAtlas]}}),_vm._v(\" show thumbnails \")])])]),_c('a11y-dialog',{attrs:{\"id\":\"app-dialog\",\"app-root\":\"#viewer\",\"dialog-root\":\"#dialog-root\",\"class-names\":{\n      base: 'dialog',\n      overlay: 'dialog-overlay',\n      element: 'dialog-content',\n      title: 'dialog-title',\n      document: 'dialog-document',\n      closeButton: 'dialog-close'\n    }},on:{\"dialog-ref\":_vm.assignDialogRef},scopedSlots:_vm._u([{key:\"title\",fn:function(){return [_c('span',[_vm._v(\"Big files alert!\")])]},proxy:true}],null,false,803477136)},[_c('div',[_c('p',[_vm._v(\" Some categories (especially manuscripts, photographs, and negatives) have \"),_c('em',[_vm._v(\"a lot\")]),_vm._v(\" of images (updwards of 100 megabytes) and their thumbnails will take a while to download. If you are in a mobile device you might want to wait until you are on Wi-Fi to view them or they might not load at all. \")]),_c('div',{staticClass:\"dialog-buttons\"},[_c('button',{staticClass:\"button-confirm\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.acceptAtlas}},[_vm._v(\" Gimme those thumbnails! \")]),_c('button',{staticClass:\"button-cancel\",attrs:{\"type\":\"button\"},on:{\"click\":_vm.cancelAtlas}},[_vm._v(\" Don't show thumbnails \")])])])]),_c('viz',{ref:\"viz\",staticClass:\"viz\"})],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"three\"},[_c('canvas',{ref:\"three\",staticClass:\"three\",on:{\"mousemove\":function($event){$event.preventDefault();return _vm.onDocumentMouseMove($event)},\"mousedown\":function($event){$event.preventDefault();return _vm.onDocumentMouseDown($event)},\"mouseup\":function($event){$event.preventDefault();return _vm.onDocumentMouseUp($event)},\"dblclick\":function($event){$event.preventDefault();return _vm.onDoubleClick($event)}}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { LinearFilter, Sprite, SpriteMaterial, Texture } from 'three';\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n    return arr2;\n  }\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nvar three = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  LinearFilter: LinearFilter,\n  Sprite: Sprite,\n  SpriteMaterial: SpriteMaterial,\n  Texture: Texture\n};\n\nvar _default =\n/*#__PURE__*/\nfunction (_three$Sprite) {\n  _inherits(_default, _three$Sprite);\n\n  function _default() {\n    var _this;\n\n    var text = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n    var textHeight = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;\n    var color = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'rgba(255, 255, 255, 1)';\n\n    _classCallCheck(this, _default);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(_default).call(this, new three.SpriteMaterial({\n      map: new three.Texture()\n    })));\n    _this._text = \"\".concat(text);\n    _this._textHeight = textHeight;\n    _this._color = color;\n    _this._fontFace = 'Arial';\n    _this._fontSize = 90; // defines text resolution\n\n    _this._fontWeight = 'normal';\n    _this._canvas = document.createElement('canvas');\n    _this._texture = _this.material.map;\n    _this._texture.minFilter = three.LinearFilter;\n\n    _this._genCanvas();\n\n    return _this;\n  }\n\n  _createClass(_default, [{\n    key: \"_genCanvas\",\n    value: function _genCanvas() {\n      var _this2 = this;\n\n      var canvas = this._canvas;\n      var ctx = canvas.getContext('2d');\n\n      var lines = this._text.split('\\n');\n\n      var font = \"\".concat(this.fontWeight, \" \").concat(this.fontSize, \"px \").concat(this.fontFace);\n      ctx.font = font; // measure canvas with appropriate font\n\n      canvas.width = Math.max.apply(Math, _toConsumableArray(lines.map(function (line) {\n        return ctx.measureText(line).width;\n      })));\n      canvas.height = this.fontSize * lines.length; // Set font again after canvas is resized, as context properties are reset\n\n      ctx.font = font;\n      ctx.fillStyle = this.color;\n      ctx.textBaseline = 'bottom';\n      lines.forEach(function (line, index) {\n        return ctx.fillText(line, (canvas.width - ctx.measureText(line).width) / 2, (index + 1) * _this2.fontSize);\n      }); // Inject canvas into sprite\n\n      this._texture.image = canvas;\n      this._texture.needsUpdate = true;\n      var yScale = this.textHeight * lines.length;\n      this.scale.set(yScale * canvas.width / canvas.height, yScale);\n    }\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      return new this.constructor(this.text, this.textHeight, this.color).copy(this);\n    }\n  }, {\n    key: \"copy\",\n    value: function copy(source) {\n      three.Sprite.prototype.copy.call(this, source);\n      this.color = source.color;\n      this.fontFace = source.fontFace;\n      this.fontSize = source.fontSize;\n      this.fontWeight = source.fontWeight;\n      return this;\n    }\n  }, {\n    key: \"text\",\n    get: function get() {\n      return this._text;\n    },\n    set: function set(text) {\n      this._text = text;\n\n      this._genCanvas();\n    }\n  }, {\n    key: \"textHeight\",\n    get: function get() {\n      return this._textHeight;\n    },\n    set: function set(textHeight) {\n      this._textHeight = textHeight;\n\n      this._genCanvas();\n    }\n  }, {\n    key: \"color\",\n    get: function get() {\n      return this._color;\n    },\n    set: function set(color) {\n      this._color = color;\n\n      this._genCanvas();\n    }\n  }, {\n    key: \"fontFace\",\n    get: function get() {\n      return this._fontFace;\n    },\n    set: function set(fontFace) {\n      this._fontFace = fontFace;\n\n      this._genCanvas();\n    }\n  }, {\n    key: \"fontSize\",\n    get: function get() {\n      return this._fontSize;\n    },\n    set: function set(fontSize) {\n      this._fontSize = fontSize;\n\n      this._genCanvas();\n    }\n  }, {\n    key: \"fontWeight\",\n    get: function get() {\n      return this._fontWeight;\n    },\n    set: function set(fontWeight) {\n      this._fontWeight = fontWeight;\n\n      this._genCanvas();\n    }\n  }]);\n\n  return _default;\n}(three.Sprite);\n\nexport default _default;\n","<template>\n  <div class=\"three\">\n    <canvas\n      ref=\"three\"\n      class=\"three\"\n      @mousemove.prevent=\"onDocumentMouseMove\"\n      @mousedown.prevent=\"onDocumentMouseDown\"\n      @mouseup.prevent=\"onDocumentMouseUp\"\n      @dblclick.prevent=\"onDoubleClick\"\n    ></canvas>\n  </div>\n</template>\n\n<script>\n/* eslint-disable no-console */\nimport { mapState, mapGetters, mapActions } from 'vuex'\n\nimport * as THREE from 'three'\nimport { GUI } from 'three/examples/jsm/libs/dat.gui.module.js'\nimport { TrackballControls } from 'three/examples/jsm/controls/TrackballControls.js'\nimport SpriteText from 'three-spritetext'\n\n// camera stuff\nconst CAMERA_NEAR = 0.0001\nconst CAMERA_FAR = 10\nconst CAMERA_FOV = 45\nconst CAMERA_MIN_DIST = 0.001\nconst CAMERA_MAX_DIST = 4\n\n// tile stuff\nconst SMALL_ATLAS_SIZE = 2048\nconst BIG_ATLAS_SIZE = 8192\nconst ATLAS_TILE_SIZE = 32\nconst EMPTY_TEXTURE = new THREE.Texture(undefined)\n\nconst BASE_SCALE = 1.0\nconst BUCKET_Z = 1\nconst BUCKET_PADDING = 0.1\nconst FILE_Z = -1\nconst CURSOR_COLOR = new THREE.Color('hsl(3.6, 100%, 29%)')\nconst MOVE_DURATION = 300\nconst SCENE_PADDING = 2.0\nconst TEXT_SIZE = 0.025\nconst TEXT_Z = 0 // relative\nconst TILE_PADDING = 0.5\n\nconst vShader = `\nprecision mediump float;\n\n// these come built in with three.js; they're basically always used in the same way (see below)\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec3 cameraPosition;\n\n// these are uniforms we specified\nuniform float atlasPx;\nuniform float cellPx;\nuniform float pointScale;\nuniform float showAtlases;\nuniform float loadedAtlases;\n\n// these are the buffer attributes we specified when creating the geometry\nattribute vec3 position;\nattribute vec2 uv;\n\n// these are attributes we will pass from the vertex to the fragment shader\nvarying vec2 vUv;\nvarying float vShowAtlases;\nvarying float vLoadedAtlases;\n\nattribute float fileIndex;\nattribute float size;\nvarying float vFileIndex;\nattribute vec3 color;\nvarying vec3 vColor;\n\nvoid main() {\n  vColor = color;\n  vShowAtlases = showAtlases;\n  vLoadedAtlases = loadedAtlases;\n  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n  gl_PointSize = size * pointScale / -mvPosition.z;\n  gl_Position = projectionMatrix * mvPosition;\n\n  // pass the varying data to the fragment shader\n  vUv = uv;\n  vFileIndex = fileIndex;\n}\n`\n\nconst buildTextureTree = (count) => {\n  const tree = []\n  for (let i = 0; i < count; i++) {\n    const str = `\n    if (textureIndex == ${i}) {\n      gl_FragColor = texture2D(texture[${i}], uv);\n      if (gl_FragColor == vec4(0.0, 0.0, 0.0, 0.0)) gl_FragColor = vec4(vColor, 1.0);\n    }`\n    tree.push(str)\n  }\n  return tree.join('')\n}\n\nconst fShader = (atlasCount) => `\nprecision mediump float;\n\nuniform sampler2D texture[${atlasCount}];\nuniform float atlasPx;\nuniform float cellPx;\n\nvarying vec2 vUv;\nvarying float vFileIndex;\nvarying float vShowAtlases;\nvarying float vLoadedAtlases;\nvarying vec3 vColor;\n\nvoid main() {\n  vec2 uv = (vUv * cellPx + gl_PointCoord.xy * cellPx) / atlasPx;\n  int textureIndex = int(vFileIndex);\n\n  if (vShowAtlases > 0.5 && vLoadedAtlases > 0.5) {\n    ${buildTextureTree(atlasCount)}\n  } else {\n    gl_FragColor = vec4(vColor, 1.0);\n  }\n}\n`\n\nconst getPointScale = (side) => {\n  return window.innerHeight / (side * TILE_PADDING)\n}\n\nconst getBoundsFromMesh = (obj) => {\n  const o = new THREE.Box3()\n  const count = obj.instanceMatrix.count\n  const matrix = new THREE.Matrix4()\n  const p = new THREE.Vector3()\n  const s = new THREE.Vector3()\n  const q = new THREE.Quaternion()\n  for (let i = 0, i3 = 0, l = count; i < l; i++, i3 += 3) {\n    obj.getMatrixAt(i, matrix)\n    matrix.decompose(p, q, s)\n    const x = p.x\n    const y = p.y\n    const z = p.z\n    const objBucket = new THREE.Mesh(new THREE.PlaneBufferGeometry(s.x, s.x))\n    objBucket.position.set(x, y, z * s.x)\n    o.expandByObject(objBucket)\n  }\n  return o\n}\n\nconst getBoundsFromGroup = (obj) => {\n  const o = new THREE.Box3()\n  const count = obj.children.length\n  for (let i = 0, l = count; i < l; i++) {\n    const child = obj.children[i]\n    o.expandByObject(child)\n  }\n  return o\n}\n\nconst easeInOutQuad = (t, b, c, d) => {\n  // t: current time, b: beginning value, c: change In value, d: duration\n  if ((t /= d / 2) < 1) return (c / 2) * t * t + b\n  return (-c / 2) * (--t * (t - 2) - 1) + b\n}\n\nconst createBaseCamera = () => {\n  const aspect = window.innerWidth / window.innerHeight\n  const camera = new THREE.PerspectiveCamera(\n    CAMERA_FOV,\n    aspect,\n    CAMERA_NEAR,\n    CAMERA_FAR\n  )\n  camera.position.x = 0\n  camera.position.y = 0\n  camera.position.z = BUCKET_Z + 10\n  camera.updateProjectionMatrix()\n  return camera\n}\n\nconst createEmptyAtlases = (count) => {\n  const atlases = []\n  for (let i = 0; i < count; i++) {\n    atlases.push(EMPTY_TEXTURE)\n  }\n  return atlases\n}\n\nconst createText = (text, x, y, z, scale) => {\n  text = text ? text : '[undefined]'\n  if (isNaN(text) && text.indexOf('|||') !== -1) text = text.split('|||')[1]\n  const myText = new SpriteText(text)\n  myText.fontFace = 'monospace'\n  myText.textHeight = TEXT_SIZE * scale\n  myText.position.set(x, y, z)\n  myText.center = new THREE.Vector2(0, 0)\n  return myText\n}\n\nexport default {\n  components: {},\n  data() {\n    return {\n      isDragging: false,\n      lastMouse: null,\n      bucketsGroup: null,\n      camera: null,\n      cameraMoveStart: null,\n      cameraObj: null,\n      controls: null,\n      cursor: null,\n      detailMode: false,\n      isMoving: false,\n      lastMouseMoveId: null,\n      lastChange: 0,\n      lastFileId: null,\n      fileMode: false,\n      filesMoveFrom: null,\n      filesMoveStart: null,\n      filesMoveTo: null,\n      filesObject: null,\n      lastCamera: null,\n      mouse: {},\n      PAST_INTERSECTED: {},\n      pickingMesh: null,\n      raycaster: null,\n      renderer: null,\n      scaled: false,\n      scene: null,\n      selectedInstance: {},\n      selectedBucket: null,\n      textGroup: null,\n      toCamera: null,\n      toLook: null,\n      visibleFiles: [],\n      visibleFilesCount: 0\n    }\n  },\n  computed: {\n    ...mapGetters(['totalFromBuckets']),\n    ...mapState([\n      'fileData',\n      'defaultPositions',\n      'defaultColors',\n      'huePositions',\n      'hueIndexes',\n      'tsnePositions',\n      'tsneIndexes',\n      'atlases',\n      'loadedAtlas',\n      'currentBucket',\n      'itemsTotal',\n      'sort',\n      'stuff',\n      'showAtlases'\n    ])\n  },\n  mounted() {\n    this.init()\n    this.createControls()\n    this.paintBuckets()\n    this.moveCameraTo(this.bucketsGroup)\n    this.animate()\n    window.addEventListener('resize', this.onResize)\n    document.addEventListener('mouseout', this.onDocumentMouseOut)\n  },\n  beforeDestroy() {\n    // Unregister resize before destroying this Vue instance\n    window.removeEventListener('resize', this.onResize)\n    document.removeEventListener('mouseout', this.onDocumentMouseOut)\n  },\n  watch: {\n    currentBucket(newB) {\n      if (newB) {\n        if (this.cameraObj) {\n          this.initFiles(this.cameraObj)\n          this.paintSort()\n        }\n      }\n    },\n    atlases() {\n      this.paintAtlas()\n    },\n    showAtlases(shown) {\n      if (shown && this.selectedBucket) {\n        const { atlasCount } = this.calculateAtlases()\n        this.fetchAtlases(atlasCount)\n      }\n      this.paintAtlas()\n    },\n    sort(to, from) {\n      this.filesMoveStart = Date.now()\n      this.filesMoveFrom = from\n      this.filesMoveTo = to\n    }\n  },\n  methods: {\n    backToEverything() {\n      this.camera.layers.enable(0)\n      this.cleanFiles()\n      this.moveCameraTo(this.bucketsGroup)\n      this.hideCursor()\n      this.selectedInstance = {}\n      this.fileMode = false\n      this.$store.commit('setBucket', null)\n    },\n    paintSort() {\n      if (!this.filesObject) return\n      this.filesMoveStart = Date.now() - MOVE_DURATION\n      this.filesMoveTo = this.sort\n    },\n    init() {\n      this.renderer = new THREE.WebGLRenderer({\n        antialias: true,\n        canvas: this.$refs.three,\n        powerPreference: 'high-performance'\n      }) // false improves the frame rate\n      this.renderer.outputEncoding = THREE.sRGBEncoding\n      this.renderer.gammaFactor = 2.2\n      this.renderer.setPixelRatio(window.devicePixelRatio)\n\n      this.renderer.setSize(window.innerWidth, window.innerHeight)\n\n      this.scene = new THREE.Scene()\n      this.scene.background = new THREE.Color('hsl(0, 0%, 15%)')\n\n      this.raycaster = new THREE.Raycaster()\n      this.mouse = new THREE.Vector2(-1e10, -1e10) // init far outside the canvas\n\n      this.camera = createBaseCamera()\n\n      // cursor\n      const geometry = new THREE.ShapeBufferGeometry(\n        new THREE.Shape()\n          .moveTo(0.5, 0.5)\n          .lineTo(0.5, -0.5)\n          .lineTo(-0.5, -0.5)\n          .lineTo(-0.5, 0.5)\n          .lineTo(0.5, 0.5)\n      )\n      const material = new THREE.MeshBasicMaterial({\n        color: CURSOR_COLOR\n      })\n      const mesh = new THREE.Mesh(geometry, material)\n      mesh.visible = false\n      this.cursor = mesh\n      this.scene.add(this.cursor)\n\n      // const gui = new GUI()\n\n      // gui.add(this, 'showAtlases')\n    },\n    onDoubleClick(e) {\n      this.camera.layers.disableAll()\n      if (this.fileMode) {\n        this.camera.layers.enable(1)\n        return\n      }\n      if (this.PAST_INTERSECTED.instanceId !== undefined) {\n        this.camera.layers.enable(1)\n        const key = this.PAST_INTERSECTED.obj.bucketIndex\n        this.selectedBucket = this.stuff[key]\n        const x = this.PAST_INTERSECTED.obj.position.x\n        const y = this.PAST_INTERSECTED.obj.position.y\n        const w = this.PAST_INTERSECTED.obj.geometry.parameters.width\n        const obj = new THREE.Mesh(new THREE.PlaneBufferGeometry(w, w))\n        obj.position.set(x, y, FILE_Z)\n        this.moveCameraTo(obj)\n        this.fileMode = true\n        this.cameraObj = obj\n        window.setTimeout(() => (this.PAST_INTERSECTED = {}), 100)\n        this.$store.commit('setBucket', this.selectedBucket)\n      } else {\n        this.camera.layers.enable(0)\n      }\n    },\n    createControls() {\n      this.controls = new TrackballControls(this.camera, this.$refs.three)\n      this.controls.rotateSpeed = 1.0\n      this.controls.zoomSpeed = 1\n      this.controls.panSpeed = 0.1\n      this.controls.maxDistance = CAMERA_MAX_DIST\n      this.controls.minDistance = CAMERA_MIN_DIST\n      this.controls.mouseButtons.LEFT = THREE.MOUSE.PAN\n      this.controls.mouseButtons.RIGHT = THREE.MOUSE.ROTATE\n      this.controls.noRotate = true\n      this.controls.dynamicDampingFactor = 0.1\n    },\n    cleanFiles() {\n      if (this.filesObject) {\n        this.scene.remove(this.filesObject)\n        this.filesObject.geometry.dispose()\n        if (this.filesObject.material.map)\n          this.filesObject.material.map.dispose()\n        this.filesObject.material.dispose()\n      }\n\n      // TODO: dispose of atlases\n\n      // remove picking\n      if (this.pickingMesh) {\n        this.scene.remove(this.pickingMesh)\n        this.pickingMesh.geometry.dispose()\n        this.pickingMesh.material.map.dispose()\n        this.pickingMesh.material.dispose()\n      }\n    },\n    calculateAtlases() {\n      if (!this.selectedBucket) return\n      const tileCount = this.selectedBucket.count\n\n      const smallAtlasCount = Math.pow(SMALL_ATLAS_SIZE / ATLAS_TILE_SIZE, 2)\n\n      const bigAtlasCount = Math.pow(BIG_ATLAS_SIZE / ATLAS_TILE_SIZE, 2)\n\n      let countPerAtlas, atlasSize\n\n      if (tileCount > smallAtlasCount) {\n        atlasSize = BIG_ATLAS_SIZE\n        countPerAtlas = bigAtlasCount\n      } else {\n        atlasSize = SMALL_ATLAS_SIZE\n        countPerAtlas = smallAtlasCount\n      }\n\n      const atlasPerSide = atlasSize / ATLAS_TILE_SIZE\n\n      const atlasCount = Math.ceil(tileCount / countPerAtlas)\n\n      return {\n        atlasPerSide,\n        countPerAtlas,\n        atlasSize,\n        atlasCount\n      }\n    },\n    fetchAtlases(atlasCount) {\n      let loadedAtlases = false\n      // check to see if atlases are in memory\n      let atlases = this.atlases[this.currentBucket.key]\n      if (atlases && atlases.length === atlasCount) {\n        loadedAtlases = true\n      } else {\n        atlases = createEmptyAtlases(atlasCount)\n        // load the atlases asynchronously\n        const bucket = this.currentBucket\n        this.getCurrentAtlases({ bucket, atlasCount })\n      }\n      return { atlases, loadedAtlases }\n    },\n    paintAtlas() {\n      if (!this.filesObject) return\n      if (!this.currentBucket) return\n      if (!this.showAtlases) {\n        // remove atlases\n        const { atlasCount } = this.calculateAtlases()\n        const atlases = createEmptyAtlases(atlasCount)\n        this.filesObject.material.uniforms.texture.value = atlases\n        this.filesObject.material.uniforms.texture.needsUpdate = true\n        this.filesObject.material.uniforms.loadedAtlases.value = 0.0\n        this.filesObject.material.uniforms.loadedAtlases.needsUpdate = true\n        this.filesObject.material.uniforms.showAtlases.value = 0.0\n        this.filesObject.material.uniforms.showAtlases.needsUpdate = true\n      } else if (this.atlases[this.currentBucket.key]) {\n        const arr = [],\n          observable = this.atlases[this.currentBucket.key]\n        for (let i = 0; i < Number.POSITIVE_INFINITY; i++) {\n          if (observable[i]) arr.push(observable[i])\n          else break\n        }\n        this.filesObject.material.uniforms.texture.value = arr\n        this.filesObject.material.uniforms.texture.needsUpdate = true\n        this.filesObject.material.uniforms.loadedAtlases.value = 1.0\n        this.filesObject.material.uniforms.loadedAtlases.needsUpdate = true\n        this.filesObject.material.uniforms.showAtlases.value = 1.0\n        this.filesObject.material.uniforms.showAtlases.needsUpdate = true\n      }\n    },\n    initFiles(obj) {\n      this.cleanFiles()\n\n      const tileCount = this.selectedBucket.count\n\n      const side = Math.ceil(Math.sqrt(tileCount))\n      const w = obj.geometry.parameters.width\n      const tileSize = w / side\n      const realW = w\n\n      const geometry = new THREE.BufferGeometry()\n\n      const {\n        atlasPerSide,\n        countPerAtlas,\n        atlasSize,\n        atlasCount\n      } = this.calculateAtlases()\n\n      let atlases = [],\n        loadedAtlases = false\n      if (this.showAtlases) {\n        const fetched = this.fetchAtlases(atlasCount)\n        atlases = fetched.atlases\n        loadedAtlases = fetched.loadedAtlases\n      } else {\n        atlases = createEmptyAtlases(atlasCount)\n      }\n\n      const material = new THREE.RawShaderMaterial({\n        vertexShader: vShader,\n        fragmentShader: fShader(atlasCount),\n        uniforms: {\n          loadedAtlases: {\n            type: 'f',\n            value: loadedAtlases ? 1.0 : 0.0\n          },\n          showAtlases: {\n            type: 'f',\n            value: this.showAtlases ? 1.0 : 0.0\n          },\n          texture: {\n            type: 't',\n            value: atlases\n          },\n          atlasPx: {\n            type: 'f',\n            value: atlasSize\n          },\n          cellPx: {\n            type: 'f',\n            value: ATLAS_TILE_SIZE\n          },\n          pointScale: {\n            type: 'f',\n            value: getPointScale(side)\n          }\n        },\n        depthTest: true,\n        transparent: true,\n        vertexColors: true\n      })\n\n      const uvs = new Float32Array(tileCount * 2)\n      const fIndices = new Float32Array(tileCount)\n\n      for (let i = 0; i < tileCount; i++) {\n        const fileIndex = Math.floor(i / countPerAtlas)\n        const j = i % countPerAtlas // index in atlas\n        const x = j % atlasPerSide // position in atlas\n        const y = Math.floor(j / atlasPerSide)\n        uvs[i * 2] = x\n        uvs[i * 2 + 1] = y\n        fIndices[i] = fileIndex\n      }\n\n      geometry.setAttribute('uv', new THREE.BufferAttribute(uvs, 2, true))\n\n      const sizes = new Float32Array(tileCount).fill(w) // for some reason the size of the point is the size of the full square \\_()_/\n      geometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1))\n\n      geometry.setAttribute('fileIndex', new THREE.BufferAttribute(fIndices, 1))\n\n      geometry.setAttribute(\n        'color',\n        new THREE.Float32BufferAttribute(this.defaultColors, 3)\n      )\n\n      this.filesObject = new THREE.Points(geometry, material)\n      this.filesObject.frustumCulled = false\n      this.filesObject.layers.set(1)\n\n      // picking texture\n      const emptyTexture = createEmptyAtlases(1)[0]\n      const planeMaterial = new THREE.MeshBasicMaterial({\n        opacity: 0,\n        transparent: true,\n        map: emptyTexture\n      })\n      const pickingGeometry = new THREE.PlaneBufferGeometry(realW, realW, 1, 1)\n      this.pickingMesh = new THREE.Mesh(pickingGeometry, planeMaterial)\n      this.pickingMesh.layers.set(1)\n      this.pickingMesh.position.x = obj.position.x\n      this.pickingMesh.position.y = obj.position.y\n      this.pickingMesh.position.z = obj.position.z\n      this.scene.add(this.pickingMesh)\n\n      // an mga object to hold the bucket file real world data\n      this.filesObject.mga = {\n        realW,\n        side,\n        tileSize,\n        tileCount,\n        x: obj.position.x,\n        y: obj.position.y,\n        z: obj.position.z\n      }\n\n      this.scene.add(this.filesObject)\n    },\n    interpolateFiles() {\n      if (!this.filesObject || !this.filesMoveStart) return\n      const t = Date.now() - this.filesMoveStart\n      let from, to\n      switch (this.filesMoveFrom) {\n        case 'default':\n          from = this.defaultPositions\n          break\n        case 'hue':\n          from = this.huePositions\n          break\n        case 'similar':\n          from = this.tsnePositions\n          break\n      }\n      switch (this.filesMoveTo) {\n        case 'default':\n          to = this.defaultPositions\n          break\n        case 'hue':\n          to = this.huePositions\n          break\n        case 'similar':\n          to = this.tsnePositions\n          break\n      }\n      if (t >= MOVE_DURATION) {\n        from = to\n        this.filesMoveStart = null\n      }\n\n      const { realW, tileCount, tileSize, side } = this.filesObject.mga\n      const x = this.filesObject.mga.x - realW * 0.5 + tileSize * 0.5\n      const y = this.filesObject.mga.y + realW * 0.5 - tileSize * 0.5\n      const z = this.filesObject.mga.z\n\n      const spacing = realW / side\n      const positions = new Float32Array(tileCount * 3)\n      const position = new THREE.Vector3()\n\n      for (let i = 0, i3 = 0, l = tileCount; i < l; i++, i3 += 3) {\n        const xF = from[i3]\n        const yF = from[i3 + 1]\n        const zF = from[i3 + 2]\n        const xT = to[i3]\n        const yT = to[i3 + 1]\n        const zT = to[i3 + 2]\n        let xx = easeInOutQuad(t, xF, xT - xF, MOVE_DURATION)\n        let yy = easeInOutQuad(t, yF, yT - yF, MOVE_DURATION)\n        let zz = easeInOutQuad(t, zF, zT - zF, MOVE_DURATION)\n\n        xx = x + xx * spacing\n        yy = y + yy * -spacing\n        zz = z + zz\n        position.set(xx, yy, zz)\n        position.toArray(positions, i3)\n      }\n      this.filesObject.geometry.setAttribute(\n        'position',\n        new THREE.Float32BufferAttribute(positions, 3)\n      )\n    },\n    paintBuckets() {\n      this.cleanBuckets()\n\n      const buckets = Object.values(this.stuff).filter((b) => b.count > 0)\n      buckets.sort((a, b) => b.count - a.count)\n\n      const bucketCount = buckets.length\n      const colors = new Float32Array(bucketCount * 3)\n      const color = new THREE.Color()\n      const bucketsGroup = new THREE.Group()\n      const textGroup = new THREE.Group()\n      const side = Math.ceil(Math.sqrt(bucketCount))\n      const xini = -1\n      const yini = 1\n      const fullW = 2\n      const spacing = fullW / side\n\n      for (let i = 0, i3 = 0, l = bucketCount; i < l; i++, i3 += 3) {\n        const b = buckets[i]\n        const count = b.count\n        const text = b.name\n        const pct = count / this.itemsTotal\n        const scale = this.scaled ? Math.sqrt(pct) : BASE_SCALE\n        const w = (spacing - spacing * BUCKET_PADDING) * scale\n        const x = xini + (i % side) * spacing\n        const y = yini - Math.floor(i / side) * spacing\n        const z = BUCKET_Z\n\n        color.setHSL(0.01 + 0.1 * (i / l), 1.0, 0.5)\n        color.toArray(colors, i * 3)\n\n        // thumb\n        const geometry = new THREE.PlaneBufferGeometry(w, w)\n        const url = b.images[Math.floor(Math.random() * b.images.length)]\n        const texture = new THREE.TextureLoader().load(url)\n        texture.encoding = THREE.sRGBEncoding\n        const material = new THREE.MeshBasicMaterial({\n          map: texture,\n          color: 0xffffff\n        })\n        const mesh = new THREE.Mesh(geometry, material)\n        mesh.bucketIndex = b.key\n        mesh.position.set(x, y, z)\n        bucketsGroup.add(mesh)\n\n        // text particles\n        const textTop = y + w / 2\n        const textZ = BUCKET_Z + TEXT_Z * scale\n        const labelStr = text\n        const numberStr = count\n        textGroup.add(\n          createText(\n            `${labelStr.toUpperCase()}: ${new Intl.NumberFormat().format(\n              numberStr\n            )}`,\n            x - w / 2,\n            textTop,\n            textZ,\n            scale\n          )\n        )\n      }\n\n      this.bucketsGroup = bucketsGroup\n\n      this.textGroup = textGroup\n\n      this.scene.add(this.bucketsGroup)\n      this.scene.add(this.textGroup)\n    },\n    cleanBuckets() {\n      if (!this.bucketsGroup) return\n      this.textGroup.children.forEach((t) => t.material.map.dispose())\n      this.bucketsGroup.children.forEach((t) => {\n        t.geometry.dispose()\n        t.material.map.dispose()\n      })\n      this.scene.remove(this.bucketsGroup)\n      this.scene.remove(this.textGroup)\n    },\n    moveCameraTo(obj) {\n      let o\n\n      if (obj instanceof THREE.InstancedMesh) {\n        o = getBoundsFromMesh(obj)\n      } else if (obj instanceof THREE.Group) {\n        // centering on the current base bucket\n        o = getBoundsFromGroup(obj)\n      } else {\n        o = new THREE.Box3().setFromObject(obj)\n      }\n\n      const sphere = new THREE.Sphere()\n      o.getBoundingSphere(sphere)\n      const side = sphere.radius * SCENE_PADDING\n\n      const center = new THREE.Vector3()\n      o.getCenter(center)\n\n      const fov = CAMERA_FOV * (Math.PI / 180)\n      const dist = Math.abs(side / Math.sin(fov / 2))\n\n      const dir = new THREE.Vector3(0, 0, 1)\n      const newPos = new THREE.Vector3().addVectors(center, dir.setLength(dist))\n\n      this.lastCamera = this.camera.clone()\n      this.toCamera = this.camera.clone()\n      this.toCamera.position.copy(newPos)\n      this.toLook = center\n\n      this.cameraMoveStart = Date.now()\n      this.isMoving = true\n    },\n    interpolateCamera() {\n      if (!this.lastCamera) return\n      const t = Date.now() - this.cameraMoveStart\n\n      const xF = this.lastCamera.position.x\n      const yF = this.lastCamera.position.y\n      const zF = this.lastCamera.position.z\n      const xT = this.toCamera.position.x\n      const yT = this.toCamera.position.y\n      const zT = this.toCamera.position.z\n      const newPos = new THREE.Vector3()\n      newPos.x = easeInOutQuad(t, xF, xT - xF, MOVE_DURATION)\n      newPos.y = easeInOutQuad(t, yF, yT - yF, MOVE_DURATION)\n      newPos.z = easeInOutQuad(t, zF, zT - zF, MOVE_DURATION)\n      this.camera.position.copy(newPos)\n\n      const cF = this.controls.target.clone()\n      const cT = this.toLook.clone()\n      const center = new THREE.Vector3()\n      center.x = easeInOutQuad(t, cF.x, cT.x - cF.x, MOVE_DURATION)\n      center.y = easeInOutQuad(t, cF.y, cT.y - cF.y, MOVE_DURATION)\n      center.z = easeInOutQuad(t, cF.z, cT.z - cF.z, MOVE_DURATION)\n      this.controls.target.copy(center)\n\n      if (t > MOVE_DURATION) {\n        this.camera.position.copy(this.toCamera.position)\n        this.controls.target.copy(this.toLook)\n        this.lastCamera = null\n        this.toCamera = null\n        this.isMoving = false\n      }\n    },\n    animate() {\n      requestAnimationFrame(this.animate)\n      this.interpolateCamera()\n      this.interpolateFiles()\n      this.controls.update()\n      this.render()\n    },\n    onResize() {\n      const w = window.innerWidth\n      const h = window.innerHeight\n      this.renderer.setSize(w, h)\n      this.camera.aspect = w / h\n      this.camera.updateProjectionMatrix()\n      if (this.filesObject) {\n        const { side } = this.filesObject.mga\n        this.filesObject.material.uniforms.pointScale.value = getPointScale(\n          side\n        )\n        this.filesObject.material.uniforms.pointScale.needsUpdate = true\n      }\n    },\n    onDocumentMouseOut(event) {\n      this.lastFileId = null\n    },\n    onDocumentMouseUp(event) {\n      this.isDragging = false\n      const lastX = this.lastMouse.clientX\n      const lastY = this.lastMouse.clientY\n\n      const newX = event.clientX\n      const newY = event.clientY\n\n      const isClick = Math.abs(newX - lastX) < 2 && Math.abs(newY - lastY) < 2\n\n      if (!isClick) return\n\n      this.camera.layers.disableAll()\n      if (this.isMoving) return\n      if (this.fileMode) {\n        this.camera.layers.enable(1)\n        if (this.PAST_INTERSECTED.instanceId === undefined) {\n          // clicked outside\n          // if (this.detailMode) {\n          //   // go back to files\n          //   // this.camera.layers.enable(1)\n          //   // this.detailMode = false\n          //   // this.moveCameraTo(this.cameraObj)\n          //   // } else {\n          //   //   // go back to bucket\n          //   //   this.camera.layers.enable(0)\n          //   //   this.fileMode = false\n          //   //   this.cleanFiles()\n          //   //   this.moveCameraTo(this.selectedInstance.obj)\n          //   //   this.$store.commit('setBucket', null)\n          // }\n        } else {\n          // clicked a file\n          this.detailMode = true\n          this.moveCameraTo(this.PAST_INTERSECTED.obj)\n          this.loadFile()\n        }\n        return\n      }\n      if (this.PAST_INTERSECTED.instanceId !== undefined) {\n        // there is a selected bucket\n        this.camera.layers.enable(0)\n        if (\n          this.PAST_INTERSECTED.instanceId !== this.selectedInstance.instanceId\n        ) {\n          this.hideCursor()\n          this.moveCameraTo(this.PAST_INTERSECTED.obj)\n          this.selectedInstance = { ...this.PAST_INTERSECTED }\n        }\n        this.$store.commit('setBucket', null)\n      } else {\n        this.backToEverything()\n      }\n    },\n    onDocumentMouseDown(event) {\n      this.onDocumentMouseMove(event)\n      this.isDragging = true\n      this.lastMouse = event\n    },\n    onDocumentMouseMove(event) {\n      this.mouse.x = (event.clientX / window.innerWidth) * 2 - 1\n      this.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1\n    },\n    hideCursor() {\n      this.cursor.visible = false\n    },\n    render() {\n      this.renderer.render(this.scene, this.camera)\n      if (this.$refs.three) this.$refs.three.classList.remove('pointer')\n\n      if (this.mouse) this.raycaster.setFromCamera(this.mouse, this.camera)\n\n      this.pickBucket()\n      this.pickFile()\n    },\n    getFileAt(uv) {\n      if (!this.currentBucket) return\n      const { x, y } = uv\n      const { realW, side, tileCount } = this.filesObject.mga\n      const mx = this.filesObject.mga.x\n      const my = this.filesObject.mga.y\n      const col = Math.floor(side * x)\n      const row = Math.floor(side * (1 - y))\n      const size = 1 / side\n      const yy = 1 - y\n      const xmin = col * size + (size * TILE_PADDING) / 8\n      const xmax = col * size + size - (size * TILE_PADDING) / 8\n      const ymin = row * size + (size * TILE_PADDING) / 8\n      const ymax = row * size + size - (size * TILE_PADDING) / 8\n      // make sure it is above a square and not in the gutter\n      const index = col + row * side\n      if (x > xmin && x < xmax && yy > ymin && yy < ymax) {\n        let fileId\n        switch (this.sort) {\n          case 'default':\n            fileId = this.currentBucket.ids[index]\n            break\n          case 'hue':\n            fileId = this.currentBucket.ids[this.hueIndexes[index]]\n            break\n          case 'similar':\n            // uses same indexing as default\n            fileId = this.currentBucket.ids[this.tsneIndexes[index]]\n            break\n        }\n        if (!fileId) return null\n        const instanceId = index\n        const normalizedX = col * size * realW\n        const normalizedY = row * size * realW\n        const halfWidth = realW * 0.5 // parent obj is x,y centered\n        const normalizedHalfTile = size * 0.5 * realW\n        const tx = mx + normalizedX - halfWidth + normalizedHalfTile\n        const ty = my - normalizedY + halfWidth - normalizedHalfTile\n        return { instanceId, fileId, tx, ty }\n      }\n      return null\n    },\n    pickFile() {\n      if (this.pickingMesh && this.fileMode) {\n        const intersects = this.raycaster.intersectObject(this.pickingMesh)\n\n        if (intersects.length > 0 && intersects[0].uv) {\n          const data = this.getFileAt(intersects[0].uv)\n          if (data) {\n            const { instanceId, fileId, tx, ty } = data\n            if (this.$refs.three) this.$refs.three.classList.add('pointer')\n            if (this.PAST_INTERSECTED.instanceId !== instanceId) {\n              // new thing\n              const { tileSize } = this.filesObject.mga\n\n              const point = intersects[0].point\n              // make area bigger so it doesnt zoom so close\n              const geometry = new THREE.PlaneBufferGeometry(\n                tileSize * 2,\n                tileSize * 2\n              )\n              const material = new THREE.MeshBasicMaterial()\n              const obj = new THREE.Mesh(geometry, material)\n              obj.position.x = tx\n              obj.position.y = ty\n              obj.position.z = point.z\n              this.PAST_INTERSECTED.instanceId = instanceId\n              this.PAST_INTERSECTED.obj = obj\n              this.PAST_INTERSECTED.fileId = fileId\n            }\n          } else {\n            if (this.$refs.three) this.$refs.three.classList.remove('pointer')\n            this.PAST_INTERSECTED = {}\n          }\n        } else if (this.PAST_INTERSECTED.instanceId) {\n          if (this.$refs.three) this.$refs.three.classList.remove('pointer')\n          this.PAST_INTERSECTED = {}\n        }\n      }\n    },\n    loadFile() {\n      // get data from API\n      if (!this.PAST_INTERSECTED.fileId) {\n        this.lastFileId = null\n        return\n      }\n      const fileId = this.PAST_INTERSECTED.fileId\n      if (fileId === this.lastFileId) return\n      this.lastFileId = fileId\n      this.$store.commit('setFileData', {})\n      this.$store.dispatch('loadFile', fileId)\n    },\n    pickBucket() {\n      if (this.bucketsGroup && !this.fileMode) {\n        const intersects = this.bucketsGroup.children\n          .map((ch) => this.raycaster.intersectObject(ch))\n          .filter((ch) => ch.length > 0)\n          .map((ch) => ch[0])\n\n        if (intersects.length > 0) {\n          if (this.$refs.three) this.$refs.three.classList.add('pointer')\n          const obj = intersects[0].object\n          const instanceId = obj.bucketIndex\n          if (this.PAST_INTERSECTED.instanceId !== instanceId) {\n            if (\n              this.selectedInstance.instanceId !==\n              this.PAST_INTERSECTED.instanceId\n            ) {\n              this.hideCursor()\n            }\n\n            this.PAST_INTERSECTED.instanceId = instanceId\n            this.PAST_INTERSECTED.obj = obj\n            const w = obj.geometry.parameters.width\n            this.cursor.position.x = obj.position.x\n            this.cursor.position.y = obj.position.y + w * 0.5 + w * 0.05\n            this.cursor.position.z = obj.position.z\n            this.cursor.scale = new THREE.Vector3(w * 1.02, w * 0.1, w)\n            this.cursor.visible = true\n          }\n        } else if (this.PAST_INTERSECTED.instanceId) {\n          this.hideCursor()\n          this.PAST_INTERSECTED = {}\n        }\n      }\n    },\n    ...mapActions(['getCurrentAtlases'])\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import '@/assets/variables';\n\n.three {\n  height: 100vh;\n  width: 100vw;\n  position: relative;\n}\n.pointer {\n  cursor: pointer;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viz.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viz.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Viz.vue?vue&type=template&id=647b626c&scoped=true&\"\nimport script from \"./Viz.vue?vue&type=script&lang=js&\"\nexport * from \"./Viz.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Viz.vue?vue&type=style&index=0&id=647b626c&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"647b626c\",\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div v-if=\"loaded\" class=\"grid\" id=\"viewer\">\n    <div class=\"header\">\n      <h1 class=\"total\">\n        <p v-if=\"currentBucket\">\n          <button type=\"button\" class=\"button-back\" @click=\"back\">\n            &lt; back to everything\n          </button>\n        </p>\n        <strong>{{ formattedItemsTotal }}</strong> {{ description }}\n      </h1>\n    </div>\n    <div :class=\"{ file: true, hidden: !fileData.id || fileHidden }\" ref=\"file\">\n      <button class=\"button-hide\" type=\"button\" @click=\"fileHidden = true\">\n        hide\n      </button>\n      <div v-if=\"fileData.palette\" class=\"palette\">\n        <span\n          class=\"color\"\n          v-for=\"(color, index) in fileData.palette\"\n          :title=\"fileData.colorNames[index].join(', ')\"\n          :key=\"index\"\n          :style=\"{\n            backgroundColor: color.color,\n            width: color.percent * 100 + '%'\n          }\"\n        ></span>\n      </div>\n      <div class=\"loading\" v-if=\"!fileData.title\">Loading...</div>\n      <a\n        :href=\"filesBaseUrl + '/' + fileData.id\"\n        rel=\"noopener\"\n        target=\"_blank\"\n      >\n        <img\n          v-if=\"fileData.image\"\n          :src=\"fileData.image\"\n          :alt=\"fileData.title\"\n          :title=\"fileData.title\"\n          class=\"thumbnail\"\n        />\n      </a>\n      <p v-if=\"fileData.title\" class=\"file-description\">\n        <a\n          :href=\"filesBaseUrl + '/' + fileData.id\"\n          rel=\"noopener\"\n          target=\"_blank\"\n        >\n          {{ fileData.title }}\n        </a>\n      </p>\n    </div>\n    <div class=\"controls\">\n      <div class=\"sort\">\n        <router-link\n          :class=\"['button-sort', sort === 'default' ? 'active' : '']\"\n          :to=\"{ path: '/' }\"\n        >\n          default\n        </router-link>\n        <router-link\n          :class=\"['button-sort', sort === 'hue' ? 'active' : '']\"\n          :to=\"{ path: '/', query: { sort: 'hue' } }\"\n        >\n          color\n        </router-link>\n        <router-link\n          :class=\"['button-sort', sort === 'similar' ? 'active' : '']\"\n          :to=\"{ path: '/', query: { sort: 'similar' } }\"\n        >\n          similarity\n        </router-link>\n      </div>\n      <div class=\"atlas\">\n        <label for=\"atlas\">\n          <input\n            type=\"checkbox\"\n            id=\"atlas\"\n            v-model=\"atlasShown\"\n            @change=\"confirmAtlas\"\n          />\n          show thumbnails\n        </label>\n      </div>\n    </div>\n    <a11y-dialog\n      id=\"app-dialog\"\n      app-root=\"#viewer\"\n      dialog-root=\"#dialog-root\"\n      @dialog-ref=\"assignDialogRef\"\n      :class-names=\"{\n        base: 'dialog',\n        overlay: 'dialog-overlay',\n        element: 'dialog-content',\n        title: 'dialog-title',\n        document: 'dialog-document',\n        closeButton: 'dialog-close'\n      }\"\n    >\n      <template v-slot:title>\n        <span>Big files alert!</span>\n      </template>\n      <div>\n        <p>\n          Some categories (especially manuscripts, photographs, and negatives)\n          have <em>a lot</em> of images (updwards of 100 megabytes) and their\n          thumbnails will take a while to download. If you are in a mobile\n          device you might want to wait until you are on Wi-Fi to view them or\n          they might not load at all.\n        </p>\n        <div class=\"dialog-buttons\">\n          <button type=\"button\" class=\"button-confirm\" @click=\"acceptAtlas\">\n            Gimme those thumbnails!\n          </button>\n          <button type=\"button\" class=\"button-cancel\" @click=\"cancelAtlas\">\n            Don't show thumbnails\n          </button>\n        </div>\n      </div>\n    </a11y-dialog>\n    <viz class=\"viz\" ref=\"viz\" />\n  </div>\n</template>\n\n<script>\nimport { mapState, mapGetters } from 'vuex'\n\nimport Viz from '@/components/Viz.vue'\n\nconst FILES_BASE_URL = process.env.VUE_APP_FILES_BASE_URL\n\nexport default {\n  components: { Viz },\n  data() {\n    return {\n      atlasShown: this.showAtlases,\n      filesBaseUrl: FILES_BASE_URL,\n      fileHidden: false\n    }\n  },\n  watch: {\n    $route(to) {\n      const sort = to.query.sort ? to.query.sort : 'default'\n      if (sort !== this.sort) this.$store.commit('setSort', sort)\n    },\n    fileData(newData) {\n      if (newData.id) this.fileHidden = false\n    }\n  },\n  methods: {\n    back() {\n      this.$refs.viz.backToEverything()\n    },\n    acceptAtlas() {\n      this.atlasShown = true\n      this.$store.commit('setConfirmedAtlas', true)\n      this.$store.commit('setShowAtlases', true)\n      if (this.dialog) this.dialog.hide()\n    },\n    cancelAtlas() {\n      this.atlasShown = false\n      this.$store.commit('setConfirmedAtlas', true)\n      this.$store.commit('setShowAtlases', false)\n      if (this.dialog) this.dialog.hide()\n    },\n    confirmAtlas() {\n      if (this.atlasShown && !this.confirmedAtlas) {\n        if (this.dialog) this.dialog.show()\n      } else {\n        this.$store.commit('setShowAtlases', this.atlasShown)\n      }\n    },\n    assignDialogRef(dialog) {\n      this.dialog = dialog\n      this.dialog.on('hide', () => {\n        if (!this.confirmedAtlas) {\n          this.atlasShown = !this.atlasShown\n        }\n      })\n    }\n  },\n  computed: {\n    description() {\n      const l = Object.values(this.stuff).length\n      return this.currentBucket\n        ? this.currentBucket.description !== ''\n          ? this.currentBucket.description.trim()\n          : ''\n        : Object.values(this.stuff)\n            .filter((b) => b.count > 0)\n            .map((s, index) => (index === l - 1 ? 'and ' + s.name : s.name))\n            .join(', ')\n    },\n    total() {\n      return this.itemsTotal\n    },\n    formattedItemsTotal() {\n      return `${new Intl.NumberFormat().format(\n        this.currentBucket ? this.currentBucket.count : this.totalFromBuckets\n      )}${\n        this.currentBucket\n          ? ' ' +\n            this.currentBucket.name.trim() +\n            (this.currentBucket.description !== '' ? ':' : '')\n          : ' '\n      }`\n    },\n    ...mapGetters(['totalFromBuckets']),\n    ...mapState([\n      'fileData',\n      'confirmedAtlas',\n      'selectedBucket',\n      'loaded',\n      'itemsTotal',\n      'stuff',\n      'currentBucket',\n      'sort',\n      'showAtlases'\n    ])\n  },\n  created() {\n    this.$store.commit('setSort', this.$route.query.sort)\n    this.$store.commit('getBuckets')\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import '@/assets/variables';\n\n.grid {\n  background-color: $bg-color;\n  color: $main-color;\n  display: grid;\n  grid-template-columns: 1fr 1fr 1fr;\n  grid-template-rows: auto auto 5rem;\n}\n.button-back {\n  border: none;\n  cursor: pointer;\n  font-size: 0.9rem;\n  background-color: $main-color;\n  color: $bg-color;\n  display: inline-block;\n  text-decoration: none;\n  border-radius: 0.2rem;\n  margin: 0 0 0.25rem 0.25rem;\n  padding: 0.125rem 0.5rem;\n}\n.header {\n  background-color: transparentize($color: $bg-color, $amount: 0.25);\n  grid-column: 1/4;\n  grid-row: 1/2;\n  z-index: 1;\n}\n.total {\n  color: $main-color;\n  font-size: 1.25rem;\n  font-weight: normal;\n  max-width: 60ch;\n  margin: 0 auto;\n  padding: 0.5rem;\n}\n.controls {\n  grid-column: 1/4;\n  grid-row: 3/4;\n  z-index: 1;\n  align-items: center;\n  display: flex;\n  flex-direction: column;\n  margin: 0 auto;\n  background-color: transparentize($color: $bg-color, $amount: 0.5);\n  width: 30%;\n  min-width: 18rem;\n  border-radius: 0.5rem 0.5rem 0 0;\n}\n.sort {\n  display: flex;\n  padding-top: 0.5rem;\n}\n.atlas {\n  padding-bottom: 0.5rem;\n}\n.button-sort {\n  background-color: $main-color;\n  color: $bg-color;\n  text-decoration: none;\n  display: inline-block;\n  border-radius: 0.2rem;\n  margin: 0 0 0.5rem 0.5rem;\n  padding: 0.25rem 1rem;\n\n  &:first-child {\n    margin-left: 0;\n  }\n\n  &.active {\n    background-color: $bg-active;\n  }\n}\n.dialog-buttons {\n  display: flex;\n  margin-top: 2rem;\n}\n.button-confirm {\n  cursor: pointer;\n  color: $main-color;\n  background-color: $bg-color;\n  display: inline-block;\n  border: none;\n  border-radius: 0.2rem;\n  padding: 0.25rem 1rem;\n}\n.button-cancel {\n  cursor: pointer;\n  background-color: $main-color;\n  color: $bg-color;\n  text-decoration: underline;\n  display: inline-block;\n  border: none;\n  border-radius: 0.2rem;\n  margin-left: auto;\n  padding: 0.25rem 1rem;\n}\n.viz {\n  grid-column: 1/4;\n  grid-row: 1/4;\n}\n.file {\n  align-self: center;\n  justify-self: end;\n  background-color: transparentize($color: $bg-color, $amount: 0.1);\n  grid-row: 1/4;\n  grid-column: 3/4;\n  display: flex;\n  flex-direction: column;\n  padding: 0.5rem 0;\n  width: 300px;\n  max-width: 30vw;\n  z-index: 1;\n  transition: transform 0.2s ease-out;\n  transform: translateX(0%);\n  border-radius: 0.5rem 0 0 0.5rem;\n\n  &.hidden {\n    transform: translateX(100%);\n  }\n}\n.button-hide {\n  align-self: flex-start;\n  border: none;\n  cursor: pointer;\n  font-size: 0.8rem;\n  background-color: $main-color;\n  color: $bg-color;\n  display: inline-block;\n  text-decoration: none;\n  border-radius: 0.2rem;\n  margin: 0 0 0.5rem 0.5rem;\n  padding: 0.125rem 0.5rem;\n}\n.loading {\n  background-color: transparentize($color: $bg-color, $amount: 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  padding: 50% 0;\n}\n.palette {\n  display: flex;\n  margin-bottom: 1px;\n}\n.color {\n  font-size: 0.75rem;\n  height: 3rem;\n  padding: 0.5rem;\n  margin-right: 1px;\n\n  &:last-child {\n    margin: 0;\n  }\n}\n.thumbnail {\n  object-fit: cover;\n  width: 100%;\n  height: auto;\n}\n.file-description {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin: 0.5rem 0.5rem 0 0.5rem;\n\n  a {\n    color: $main-color;\n  }\n}\n</style>\n\n<style lang=\"scss\">\nbody {\n  overflow: hidden;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Viewer.vue?vue&type=template&id=7256940c&scoped=true&\"\nimport script from \"./Viewer.vue?vue&type=script&lang=js&\"\nexport * from \"./Viewer.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Viewer.vue?vue&type=style&index=0&id=7256940c&lang=scss&scoped=true&\"\nimport style1 from \"./Viewer.vue?vue&type=style&index=1&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7256940c\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=style&index=0&id=7256940c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viewer.vue?vue&type=style&index=0&id=7256940c&lang=scss&scoped=true&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viz.vue?vue&type=style&index=0&id=647b626c&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Viz.vue?vue&type=style&index=0&id=647b626c&lang=scss&scoped=true&\""],"sourceRoot":""}